//* Copyright (c) 2009 Nokia Corporation and/or its subsidiary(-ies).
//* All rights reserved.
//* This component and the accompanying materials are made available
//* under the terms of the License "Eclipse Public License v1.0"
//* which accompanies this distribution, and is available
//* at the URL "http://www.eclipse.org/legal/epl-v10.html".
//*
//* Initial Contributors:
//* Nokia Corporation - initial contribution.
//*
//* Contributors:
//*
//* Description:  

//
// Precondition: 
// - Detailed description can be found from Quality Center's Project: CoreSW_CASW/Module Tests/SIM ATK TSY/SimAtkTSY_testtool
//
// Script description:

// Proactive command //
///////////////////////

// AccessName (Optional)
//  Enter the Access Point name inside the quotes or as unicode hex digits.
//  Example: AccessName "abc" or AccessName 61 62 63

// AlphaId (Optional)
//  Enter the text inside the quotes or as unicode hex digits. Example: AlphaId "abc" or AlphaId 61 62 63

// Bearer (Optional, default = Bearer 3)
//	0 BearerTypeNotSet
//  1 CSDBearer
//	2 GPRSBearer
//	3 DefaultBearer
//	4 BTBearer (Bluetooth bearer)
//	5 IrDaBearer (Infra red  bearer)
//	6 RS232Bearer (RS232 bearer)
//	7 USBBearer (USB bearer)
//  Example GPRSBearer: Bearer 2

// BearerParams (Mandatory if default bearer isn't used) 
//	Enter parameters in hexadecimal numbers
//  Example with params 0x01, 0xFF: BearerParams 1 FF

// BufferSize (Optional, default = 1400)
//	Size of buffer. Example: BufferSize 1500 

// DestinationAddress (Optional, Default = 1, AddressNotPresent)
//  Enter the Destination Address inside the quotes followed by address type.
// 	AddressTypes (Optional, default = 2, EIPv4Address):
//		0 AddressNotSet, Initialisation value.
//		1 AddressNotPresent, This optional element is not present in this proactive command
//		2 IPv4Address, IP address is a IPv4 address
//		3 IPv6Address, IP address is a IPv6 address
//  Example (Address FF FF FF FF FF, type IPv6): DestinationAddress "FF FF FF FF FF" 3
//  Example (Address 01.01.01.01, type IPv4): DestinationAddress "01.01.01.01"

// IconId (Optional, default = IconId 0 0)
//  IconQualifier
//      0 NotSet
//      1 NoIconId
//      2 SelfExplanatory
//      3 NotSelfExplanatory
//  IconIdentifier
//      Id number
//  Example SelfExplanatory ID 5: IconId 2 5

// LinkEstablishment (Optional, default = 2, Immediate)
// 	0 LinkEstablishmentNotSet, Link establishment not set
//	1 OnDemand, On demand link establishment
//	2 Immediate, Immediate link establishment
//	Example LinkEstablishment 1

// LocalAddress (Optional)
//  LocalAddress is scripted just like Destination Address.

// ReconnectionMode (Optional, default = 1, NoAutomaticReconnection
//	0 ReconnectionModeNotSet, Reconnection mode not set
//	1 NoAutomaticReconnection
//	2 AutomaticReconnection
//	Example ReconnectionMode 2

// SimMeInterface (Optional, Default = 1, ProtocolNotPresent)
//	TransportProtocol
//		0 ProtocolNotSet
//		1 ProtocolNotPresent
//		2 UDP transport protocol
//		3 Tcp transport protocol
//	Port
//		Port number as decimals
// Example UDP transport protocol to port 44444: SimMeInterface 2 44444

// UserLogin (Optional)
//  Enter the User Login inside the quotes or as unicode hex digits.
//  Example: UserLogin "abc" or UserLogin 61 62 63

// UserPassword (Optional)
//  Enter the User Password inside the quotes or as unicode hex digits.
//  Example: UserPassword "abc" or UserPassword 61 62 63

// Terminal Response //
///////////////////////

// Bearer (Optional, default = Same as in PCmd)
//	Look for desription above

// BearerParams (Optional, default = Same as in PCmd) 
//	Look for desription above

// BufferSize (Optional, default = 1400)
//	Look for desription above

// GeneralResult
//  General result of the proactive command. Default command performed successfully.

// AdditionalInfo
//  Enter the text inside the quotes or as unicode hex digits.
//  If you successfully opened a channel, you need to give the channel
//  a number from 1 to 7.  Return this number plus the channel's status in
//  iAdditionalInfo.  The format is described in  ETSI TS 102 223 section
//  8.56.  See RSat::NotifyOpenChannelPCmd() for more information about
//  channel numbers.
//  Alternatively, some error values of iGeneralResult require additional
//  information, which goes here.
        
// InfoType
//  If you successfully opened a channel, then return the channel's number and
//  status in AdditionalInfo and set InfoType to
//  ChannelStatusInfo. Alternatively, some error values of
//  GeneralResult require additional information, in which case set this
//  to MeProblem.  Otherwise set to NoAdditionalInfo.


[Test]
title MOD_0024.002_SIM_ATK_TSY_[OPEN CHANNEL - related to GPRS]

create SimAtk simatk
create SimAtkNotify notify

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_OpenChannel.xml

// SEQ 2.1
notify UseObjectAddress simatk ESatNotifyOpenChannelPCmd
simatk RunIscTestCase 24 201
waittestclass notify
simatk CheckProactiveCommand Bearer 2 BearerParams 02 04 05 05 10 02 DestinationAddress "01.01.01.01" SimMeInterface 2 44444 UserLogin "UserLog" UserPassword "UserPwd"
// Terminal Response B in use due SAT server reasons, BearerParams; Precedence Class = 00
simatk SendTerminalResponse AdditionalInfo 81 0 InfoType ChannelStatusInfo BearerParams 00 04 05 05 10 02
simatk WaitForRequest

// SEQ 2.2
notify UseObjectAddress simatk ESatNotifyOpenChannelPCmd
simatk RunIscTestCase 24 202
waittestclass notify
simatk CheckProactiveCommand AccessName "\x06TestGp\x02rs" Bearer 2 BearerParams 02 04 05 05 10 02 DestinationAddress "01.01.01.01" SimMeInterface 2 44444 UserLogin "UserLog" UserPassword "UserPwd"
// Terminal Response B in use due SAT server reasons, BearerParams; Precedence Class = 00
simatk SendTerminalResponse AdditionalInfo 81 0 InfoType ChannelStatusInfo BearerParams 00 04 05 05 10 02
simatk WaitForRequest

// SEQ 2.3
notify UseObjectAddress simatk ESatNotifyOpenChannelPCmd
simatk RunIscTestCase 24 203
waittestclass notify
simatk CheckProactiveCommand AlphaId "Open ID" AccessName "\x06TestGp\x02rs" Bearer 2 BearerParams 02 04 05 05 10 02 DestinationAddress "01.01.01.01" SimMeInterface 2 44444 UserLogin "UserLog" UserPassword "UserPwd"
// Terminal Response B in use due SAT server reasons, BearerParams; Precedence Class = 00
simatk SendTerminalResponse AdditionalInfo 81 0 InfoType ChannelStatusInfo BearerParams 00 04 05 05 10 02
simatk WaitForRequest

// SEQ 2.4
// Access point seems to be invalid in this case
notify UseObjectAddress simatk ESatNotifyOpenChannelPCmd
simatk RunIscTestCase 24 204
waittestclass notify
simatk CheckProactiveCommand AlphaId "" AccessName "\x06TestGp\x02og" Bearer 2 BearerParams 02 04 05 05 10 02 DestinationAddress "01.01.01.01" SimMeInterface 2 44444 UserLogin "UserLog" UserPassword "UserPwd"
// Terminal Response B in use due SAT server reasons, BearerParams; Precedence Class = 00
simatk SendTerminalResponse AdditionalInfo 81 0 InfoType ChannelStatusInfo BearerParams 00 04 05 05 10 02
simatk WaitForRequest

// SEQ 2.5
// Let's pretend that preferred buffer size = 1400
notify UseObjectAddress simatk ESatNotifyOpenChannelPCmd
simatk RunIscTestCase 24 205
waittestclass notify
simatk CheckProactiveCommand AccessName "\x06TestGp\x02rs" Bearer 2 BearerParams 02 04 05 05 10 02 DestinationAddress "01.01.01.01" SimMeInterface 2 44444 UserLogin "UserLog" UserPassword "UserPwd" BufferSize 65535
// Terminal Response B in use due SAT server reasons, BearerParams; Precedence Class = 00
simatk SendTerminalResponse GeneralResult PerformedWithModifications AdditionalInfo 81 0 InfoType ChannelStatusInfo BearerParams 00 04 05 05 10 02
simatk WaitForRequest

// SEQ 2.6
// Void

// SEQ 2.7
// Proactive command does not provide AlphaId
notify UseObjectAddress simatk ESatNotifyOpenChannelPCmd
simatk RunIscTestCase 24 207
waittestclass notify
simatk CheckProactiveCommand AlphaId "Open ID" AccessName "\x06TestGp\x02rs" Bearer 2 BearerParams 02 04 05 05 10 02 DestinationAddress "01.01.01.01" SimMeInterface 2 44444 UserLogin "UserLog" UserPassword "UserPwd"
// Terminal Response B in use due SAT server reasons, BearerParams; Precedence Class = 00
simatk SendTerminalResponse GeneralResult PCmdNotAcceptedByUser BearerParams 00 04 05 05 10 02
simatk WaitForRequest

// SEQ 2.8
notify UseObjectAddress simatk ESatNotifyOpenChannelPCmd
simatk RunIscTestCase 24 208
waittestclass notify
simatk CheckProactiveCommand AccessName "\x06TestGp\x02rs" Bearer 2 BearerParams 02 04 05 05 10 02 DestinationAddress "01.01.01.01" SimMeInterface 2 44444 UserLogin "UserLog" UserPassword "UserPwd"
// Terminal Response B in use due SAT server reasons, BearerParams; Precedence Class = 00
simatk SendTerminalResponse GeneralResult MeUnableToProcessCmd InfoType MeProblem AdditionalInfo MeBusyOnCall BearerParams 00 04 05 05 10 02
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify
[Endtest]