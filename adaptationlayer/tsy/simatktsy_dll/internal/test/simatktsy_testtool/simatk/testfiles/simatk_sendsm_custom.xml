<?xml version="1.0" encoding="utf-8"?>

<!--
MOD_1011.001_SIM_ATK_TSY_[SEND SHORT MESSAGE - normal, packing required - with header data]
MOD_1011.002_SIM_ATK_TSY_[SEND SHORT MESSAGE - normal, invalid user data length]
MOD_1011.003_SIM_ATK_TSY_[SEND SHORT MESSAGE - normal, with validity period]
-->


<isc-test-control id="1011">


<!-- ******** -->
<!-- CHANNELS -->
<!-- ******** -->
<channels>
        <channel id="0x07"/>
</channels>


<!-- ****** -->
<!-- INPUTS -->
<!-- ****** -->
<inputs>

<!-- PROACTIVE COMMANDS -->
<!-- ****************** -->

<!-- SEND SHORT MESSAGE - normal, packing required - with header data -->
    <input id="10101">
        <name>PROACTIVE COMMAND: SEND SHORT MESSAGE</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,08,00,00,10,00,55,00,39,D0,35,81,03,01,13,01,82,02,81,83,05,0E,45,6E,76,2E,20,6D,73,67,20,30,31,2E,2E,2E,8B,1A,51,00,0B,81,10,91,56,68,07,F7,00,00,A7,0C,05,00,0C,00,10,20,00,54,65,73,74,65,90,00</message>
    </input>
    
<!-- SEND SHORT MESSAGE - normal, invalid user data length -->
    <input id="10102">
        <name>PROACTIVE COMMAND: SEND SHORT MESSAGE -invalid user data length</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,08,00,00,10,00,55,00,3B,D0,37,81,03,01,13,00,82,02,81,83,85,07,53,65,6E,64,20,53,4D,86,09,91,11,22,33,44,55,66,77,F8,8B,18,01,00,09,91,10,32,54,76,F8,40,F4,0D,54,65,73,74,20,4D,65,73,73,61,67,65,90,00</message>
    </input>
    
<!-- SEND SHORT MESSAGE - normal, with validity period relative -->
    <input id="10103">
        <name>PROACTIVE COMMAND: SEND SHORT MESSAGE -with validity period relative</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,08,00,00,10,00,55,00,4B,D0,47,81,03,01,13,00,82,02,81,83,85,05,53,53,4D,31,30,86,06,91,54,03,04,05,06,8B,2D,11,00,0A,91,54,04,05,06,07,40,14,AE,20,53,68,6F,72,74,20,6D,65,73,73,61,67,65,20,73,65,6E,74,20,66,72,6F,6D,20,53,49,4D,2D,41,54,4B,2E,90,00</message>
    </input>
    
<!-- SEND SHORT MESSAGE - normal, with validity period enhanced -->
    <input id="10104">
        <name>PROACTIVE COMMAND: SEND SHORT MESSAGE -with validity period enhanced</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,08,00,00,10,00,55,00,51,D0,4D,81,03,01,13,00,82,02,81,83,85,05,53,53,4D,31,31,86,06,91,54,03,04,05,06,8B,33,09,00,0A,91,54,04,05,06,07,40,14,43,08,07,06,00,00,00,20,53,68,6F,72,74,20,6D,65,73,73,61,67,65,20,73,65,6E,74,20,66,72,6F,6D,20,53,49,4D,2D,41,54,4B,2E,90,00</message>
    </input>
    
<!-- SEND SHORT MESSAGE - normal, with validity period absolute -->
    <input id="10105">
        <name>PROACTIVE COMMAND: SEND SHORT MESSAGE -with validity period absolute</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,08,00,00,10,00,55,00,51,D0,4D,81,03,01,13,00,82,02,81,83,85,05,53,53,4D,31,32,86,06,91,54,03,04,05,06,8B,33,19,00,0A,91,54,04,05,06,07,40,14,30,21,13,32,95,95,40,20,53,68,6F,72,74,20,6D,65,73,73,61,67,65,20,73,65,6E,74,20,66,72,6F,6D,20,53,49,4D,2D,41,54,4B,2E,90,00</message>
    </input>


<!-- SMS_MESSAGE_SEND_RESP -->
<!-- ********************* -->

<!-- SEND SHORT MESSAGE - normal, packing required - with header data -->
    <input id="30101">
        <name>SMS_MESSAGE_SEND_RESP</name>
        <direction>sos</direction>
        <message>00,00,00,02,00,00,00,00,04,03,00,01,0C,08,00,00,00,00,00,00</message>
    </input>


<!-- SIM SESSION END -->
<!-- *************** -->
    <input id="90004">
        <name>SIM Session End</name>
        <direction>sos</direction>
        <message>00,00,00,5A,00,00,78,34,00,13,00,00,90,00,00,00</message>
        <!-- Transaction Id's (9:th byte) must match with Terminal responses transaction id -->
    </input>

</inputs>


<!-- ******* -->
<!-- OUTPUTS -->
<!-- ******* -->
<outputs>

<!-- SMS_MESSAGE_SEND_REQ -->
<!-- ******************** -->

<!--
NOTE! Verifying the actual content of SMS_MESSAGE_SEND_REQ is actually beyond the scope
of SimAtkTsy TestTool as the message is created in NokiaTsy. Nevertheless message content
is verified here at the moment. However, this decision can be changed in the future if it
causes problems in test execution, due to SMS-server API-changes for example.
-->

<!-- SEND SHORT MESSAGE - normal, packing required - with header data -->
    <output id="20101">
        <name>SMS_MESSAGE_SEND_REQ</name>
        <direction>dos</direction>
        <message>00,00,00,02,00,3E,00,00,04,02,00,03,00,01,00,01,02,34,51,00,00,00,00,04,82,0C,01,08,0B,81,10,91,56,68,07,F7,82,0C,02,08,07,91,53,58,80,77,01,01,80,10,0B,0C,05,00,03,00,01,01,A8,E5,39,BD,0C,00,08,04,01,A7</message>
           <mask>00,00,00,FF,00,FF,00,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>


<!-- TERMINAL RESPONSES -->
<!-- ****************** -->

<!-- SEND SHORT MESSAGE - normal, packing required - with header data -->
    <output id="40101">
        <name>TERMINAL RESPONSE: SEND SHORT MESSAGE</name>
        <direction>dos</direction>
        <message>1D,00,10,5A,00,16,00,08,00,11,00,00,00,0C,81,03,01,13,01,82,02,82,81,83,01,00,00,00</message>
           <mask>00,00,00,FF,00,FF,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,FF,FF</mask>
    </output>
    

<!-- SEND SHORT MESSAGE - normal, invalid user data length -->
    <output id="40102">
        <name>TERMINAL RESPONSE: SEND SHORT MESSAGE</name>
        <direction>dos</direction>
        <message>00,00,00,5A,00,16,00,00,00,11,00,00,00,0C,81,03,01,13,00,02,02,82,81,03,01,32,00,00</message>
           <mask>00,00,00,FF,00,FF,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,FF,FF</mask>
    </output>
    
<!-- SEND SHORT MESSAGE - normal, with validity period -->
    <output id="40103">
        <name>TERMINAL RESPONSE: SEND SHORT MESSAGE</name>
        <direction>dos</direction>
        <message>00,00,00,5A,00,16,00,00,00,11,00,00,00,0C,81,03,01,13,00,02,02,82,81,03,01,00,00,00</message>
           <mask>00,00,00,FF,00,FF,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,FF,FF</mask>
    </output>

</outputs>


<!-- ********** -->
<!-- TEST STEPS -->
<!-- ********** -->
<steps>

<!-- PROACTIVE COMMANDS -->
<!-- ****************** -->

<!-- SEND SHORT MESSAGE - normal, packing required - with header data -->
    <step id="10101" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10101"/>
    </step>
    
<!-- SEND SHORT MESSAGE - invalid user data length -->
    <step id="10102" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10102"/>
    </step>
    
<!-- SEND SHORT MESSAGE - with validity period relative -->
    <step id="10103" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10103"/>
    </step>
    
<!-- SEND SHORT MESSAGE - with validity period enhanced -->
    <step id="10104" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10104"/>
    </step>
    
<!-- SEND SHORT MESSAGE - with validity period absolute -->
    <step id="10105" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10105"/>
    </step>


<!-- SMS_MESSAGE_SEND_REQ -->
<!-- ******************** -->

<!-- SEND SHORT MESSAGE - normal, packing required - with header data -->
    <step id="20101" type="intercept">
        <name>Intercept SMS_REQ</name>
        <channel id="0x07"/>
        <output-ref id="20101"/>
        <flags>0x40</flags>  <!-- Store transaction ID from intercepted message -->
    </step>


<!-- SMS_MESSAGE_SEND_RESP -->
<!-- ********************* -->

<!-- SEND SHORT MESSAGE - normal, packing required - with header data -->
    <step id="30101" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="30101"/>
    </step>


<!-- TERMINAL RESPONSES -->
<!-- ****************** -->

<!-- SEND SHORT MESSAGE - normal, packing required - with header data -->
    <step id="40101" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="40101"/>
        <flags>0x40</flags>  <!-- Store transaction ID from intercepted message -->
    </step>
    
<!-- SEND SHORT MESSAGE - normal, invalid user data length -->
    <step id="40102" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="40102"/>
        <flags>0x40</flags>  <!-- Store transaction ID from intercepted message -->
    </step>
    
<!-- SEND SHORT MESSAGE - normal, with validity period -->
    <step id="40103" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="40103"/>
        <flags>0x40</flags>  <!-- Store transaction ID from intercepted message -->
    </step>

<!-- GENERAL STEPS -->
<!-- ************* -->

    <step id="90001" type="sync">
        <name>Sync with test env</name>
    </step>

    <step id="90002" type="open-channel">
        <name>Attach to channel 7</name>
        <channel id="0x07"/>
    </step>

    <step id="90003" type="close-channel">
        <name>Detach from channel 7</name>
        <channel id="0x07"/>
    </step>

    <step id="90004" type="simulate">
        <name>SIM session end</name>
        <channel id="0x07"/>
        <input-ref id="90004"/>
        <flags>0x40</flags>  <!-- Use stored transaction ID in simulated message -->
    </step>

</steps>


<!-- ********** -->
<!-- TEST CASES -->
<!-- ********** -->
<cases>

<!-- SEND SHORT MESSAGE - normal, packing required - with header data -->
    <case id="101">
        <name>SEND SHORT MESSAGE, packing required, GSM 7 bit default alphabet, successful</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10101"/> <!-- Send PCMD #1 -->
            <step-ref id="20101"/> <!-- Receive SMS Req -->
            <step-ref id="30101"/> <!-- Send SMS Resp -->
            <step-ref id="40101"/> <!-- Receive TR -->
            <step-ref id="90004"/> <!-- SimSessionEnd -->
        </test-steps>
    </case>
    
<!-- SEND SHORT MESSAGE - invalid user data length -->
    <case id="102">
        <name>SEND SHORT MESSAGE, invalid user data length</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10102"/> <!-- Send PCMD #1 -->
            <step-ref id="40102"/> <!-- Receive TR -->
            <step-ref id="90004"/> <!-- SimSessionEnd -->
        </test-steps>
    </case>
    
<!-- SEND SHORT MESSAGE (normal, with validity period relative) -->
    <case id="103">
        <name>SEND SHORT MESSAGE, normal, with validity period relative</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10103"/> <!-- Send PCMD #1 -->
            <step-ref id="40103"/> <!-- Receive TR -->
            <step-ref id="90004"/> <!-- SimSessionEnd -->
        </test-steps>
    </case>
    
<!-- SEND SHORT MESSAGE (normal, with validity period enhanced) -->
    <case id="104">
        <name>SEND SHORT MESSAGE, normal, with validity period enhanced</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10104"/> <!-- Send PCMD #1 -->
            <step-ref id="40103"/> <!-- Receive TR -->
            <step-ref id="90004"/> <!-- SimSessionEnd -->
        </test-steps>
    </case>
    
<!-- SEND SHORT MESSAGE (normal, with validity period absolute) -->
    <case id="105">
        <name>SEND SHORT MESSAGE, normal, with validity period absolute</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10105"/> <!-- Send PCMD #1 -->
            <step-ref id="40103"/> <!-- Receive TR -->
            <step-ref id="90004"/> <!-- SimSessionEnd -->
        </test-steps>
    </case>

</cases>

</isc-test-control>
