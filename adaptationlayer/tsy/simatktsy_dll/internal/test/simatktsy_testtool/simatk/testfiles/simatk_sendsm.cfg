//* Copyright (c) 2009 Nokia Corporation and/or its subsidiary(-ies).
//* All rights reserved.
//* This component and the accompanying materials are made available
//* under the terms of the License "Eclipse Public License v1.0"
//* which accompanies this distribution, and is available
//* at the URL "http://www.eclipse.org/legal/epl-v10.html".
//*
//* Initial Contributors:
//* Nokia Corporation - initial contribution.
//*
//* Contributors:
//*
//* Description:  

//
// Precondition: 
// - Detailed description can be found from Quality Center's Project: CoreSW_CASW/Module Tests/SIM ATK TSY/SimAtkTSY_testtool
//
// Script description:

// Proactive command //
///////////////////////

// AlphaId (Optional)
//  Enter the text inside the quotes or as unicode hex digits. Example: AlphaId "abc" or AlphaId 61 62 63

// Address
//  Enter the destination number inside the quotes
//  TypeOfNumber (Optional, default = 1, UnknownNumber)
//      0 TypeOfNumberNotSet, initialization value used within constructor(s).
//      1 UnknownNumber, the user or the network has no knowledge of the type of network.
//      2 InternationalNumber, international number.
//      3 NationalNumber, national number.
//      4 NetworkSpecificNumber, administration/service number specific to the serving network, 
//        e.g. used to access an operator.
//      5 DedicatedNumber, called dedicated access / short code in GSM/WCDMA. Corresponds to
//        TMobileTON::ESubscriberNumber in ETel MM API.
//      6 AlphanumericNumber, alphanumeric number.
//      7 EAbbreviatedNumber, abbreviated number. 
//  NumberingPlan (Optional, default = 1, UnknownNumberingPlan)
//      0 NumberingPlanNotSet, initialization value used within constructor(s).
//      1 UnknownNumberingPlan, the user or the network has no knowledge of the numbering plan.
//      2 IsdnNumberPlan, ISDN / telephony numbering plan.
//      3 DataNumberPlan, data numbering plan.
//      4 TelexNumberPlan, telex numbering plan.
//      5 ServiceCentreSpecificPlan1, The service centre specific plan is used to indicate a numbering
//        plan specific to External Short Message Entities attached to the SMS centre.
//      6 ServiceCentreSpecificPlan2, the service centre specific plan is used to indicate a numbering
//        plan specific to External Short Message Entities attached to the SMS centre.
//      7 NationalNumberPlan, national numbering plan.
//      8 PrivateNumberPlan, private numbering plan.
//      9 ERMESNumberPlan, ERMES numbering plan.   
// Example (Number "123456789", InternationalNumber, DataNumberPlan):
// Address "123456789" 2 3
// NOTE! Address field has two different functionalities in SendSm-command. If proactive command provides
// SMSC, the address field is used to validate the SMSC. However, if SMSC is missing from proactive command,
// the address field is used as a phone's default SMSC and it shall be used when sending SM with
// "no logging" -function.

// IconId (Optional, default = IconId 0 0)
//  IconQualifier
//      0 NotSet
//      1 NoIconId
//      2 SelfExplanatory
//      3 NotSelfExplanatory
//  IconIdentifier
//      Id number
//  Example SelfExplanatory ID 5: IconId 2 5

// SmsTpdu
//  Messages SMSTPDU block in hexadecimal numbers
//  Example: SmsTpdu 01 00 09 91 10 32 54...

// SmsResult (Optional, default = 0, KErrNone )
//  Defines expected return value for SendMessageNoLogging method
//  Example: SmsResult -8302 


// Terminal Response //
///////////////////////

// GeneralResult
//  General result of the proactive command. Default command performed successfully.

// AdditionalInfo
//  Enter the text inside the quotes or as unicode hex digits

// InfoType
// If the value of iGeneralResult requires additional information,
// set this to MeProblem (2).  Otherwise set to
// NoAdditionalInfo (1). Default no additional info.


[Test]
title MOD_0011.001_SIM_ATK_TSY_[SEND SHORT MESSAGE - normal]

create SimAtk simatk
create SimAtkNotify notify

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl
simatk Open SmsMessaging

// Load ISC XML -file
simatk LoadIscTests SimAtk_SendSm.xml

// SEQ 1.1
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 101
waittestclass notify
simatk CheckProactiveCommand Address "112233445566778" 2 2 AlphaId "Send SM" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F4 0C 54 65 73 74 20 4D 65 73 73 61 67 65
simatk SendTerminalResponse
simatk WaitForRequest

// SEQ 1.2
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 102
waittestclass notify
simatk CheckProactiveCommand Address "112233445566778" 2 2 AlphaId "Send SM" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F0 07 D3 B2 9B 0C 9A 36 01
simatk SendTerminalResponse
simatk WaitForRequest

// SEQ 1.3
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 103
waittestclass notify
simatk CheckProactiveCommand Address "112233445566778" 2 2 AlphaId "Short Message" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F0 0D 53 F4 5B 4E 07 35 CB F3 79 F8 5C 06
simatk SendTerminalResponse
simatk WaitForRequest

// SEQ 1.4
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 104
waittestclass notify
simatk CheckProactiveCommand Address "112233445566778" 2 2 AlphaId "The address data object holds the RP_Destination_Address" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F0 A0 D4 FB 1B 44 CF C3 CB 73 50 58 5E 06 91 CB E6 B4 BB 4C D6 81 5A A0 20 68 8E 7E CB E9 A0 76 79 3E 0F 9F CB 20 FA 1B 24 2E 83 E6 65 37 1D 44 7F 83 E8 E8 32 C8 5D A6 DF DF F2 35 28 ED 06 85 DD A0 69 73 DA 9A 56 85 CD 24 15 D4 2E CF E7 E1 73 99 05 7A CB 41 61 37 68 DA 9C B6 86 CF 66 33 E8 24 82 DA E5 F9 3C 7C 2E B3 40 77 74 59 5E 06 D1 D1 65 50 7D 5E 96 83 C8 61 7A 18 34 0E BB 41 E2 32 08 1E 9E CF CB 64 10 5D 1E 76 CF E1
simatk SendTerminalResponse
simatk WaitForRequest

// SEQ 1.5
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 105
waittestclass notify
simatk CheckProactiveCommand Address "112233445566778" 2 2 AlphaId "The address data object holds the RP Destination Address" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F0 A0 D4 FB 1B 44 CF C3 CB 73 50 58 5E 06 91 CB E6 B4 BB 4C D6 81 5A A0 20 68 8E 7E CB E9 A0 76 79 3E 0F 9F CB 20 FA 1B 24 2E 83 E6 65 37 1D 44 7F 83 E8 E8 32 C8 5D A6 DF DF F2 35 28 ED 06 85 DD A0 69 73 DA 9A 56 85 CD 24 15 D4 2E CF E7 E1 73 99 05 7A CB 41 61 37 68 DA 9C B6 86 CF 66 33 E8 24 82 DA E5 F9 3C 7C 2E B3 40 77 74 59 5E 06 D1 D1 65 50 7D 5E 96 83 C8 61 7A 18 34 0E BB 41 E2 32 08 1E 9E CF CB 64 10 5D 1E 76 CF E1
simatk SendTerminalResponse
simatk WaitForRequest

// SEQ 1.6
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 106
waittestclass notify
// PCMD does not provide smsc
simatk CheckProactiveCommand Address "1234" 1 1 AlphaId "Two types are defined: - A short message to be sent to the network in an SMS-SUBMIT message, or an SMS-COMMAND message, where the user data can be passed transparently; - A short message to be sent to the network in an SMS-SUBMIT " SmsTpdu 01 00 02 91 10 40 F0 01 20
simatk SendTerminalResponse
simatk WaitForRequest

// SEQ 1.7
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 107
waittestclass notify
simatk CheckProactiveCommand Address "112233445566778" 2 2 AlphaId "" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F4 0C 54 65 73 74 20 4D 65 73 73 61 67 65
simatk SendTerminalResponse
simatk WaitForRequest

// SEQ 1.8
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 108
waittestclass notify
simatk CheckProactiveCommand Address "112233445566778" 2 2 SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F4 0C 54 65 73 74 20 4D 65 73 73 61 67 65
simatk SendTerminalResponse
simatk WaitForRequest

// close all
simatk Close SmsMessaging
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify
[Endtest]

[Test]
title MOD_0011.002_SIM_ATK_TSY_[SEND SHORT MESSAGE - UCS2 support]

create SimAtk simatk
create SimAtkNotify notify

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl
simatk Open SmsMessaging

// Load ISC XML -file
simatk LoadIscTests SimAtk_SendSm.xml

// SEQ 2.1
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 201
waittestclass notify
// Text in hex: "Hello" in Russia
// Note! There seems to be a bug in the spec (3GPP TS 51.010-4 V4.2.0 (2006-09))
// Second byte of SMS-TPDU (TP-MR, message reference)of command is zero, not 1 a 
// specified in the spec (SMS-PP SEND SHORT MESSAGE Message 2.1)
simatk CheckProactiveCommand Address "112233445566778" 2 2 AlphaId "Send SM" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 08 18 04 17 04 14 04 20 04 10 04 12 04 21 04 22 04 12 04 23 04 19 04 22 04 15
simatk SendTerminalResponse
simatk WaitForRequest

// close all
simatk Close SmsMessaging
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify
[Endtest]

[Test]
title MOD_0011.003_SIM_ATK_TSY_[SEND SHORT MESSAGE - icon support]

create SimAtk simatk
create SimAtkNotify notify

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl
simatk Open SmsMessaging

// Load ISC XML -file
simatk LoadIscTests SimAtk_SendSm.xml

// SEQ 3.1a
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 3011
waittestclass notify
simatk CheckProactiveCommand IconId 2 1 Address "112233445566778" 2 2 AlphaId "NO ICON" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F4 0C 54 65 73 74 20 4D 65 73 73 61 67 65
simatk SendTerminalResponse
simatk WaitForRequest

// SEQ 3.1b
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 3012
waittestclass notify
simatk CheckProactiveCommand IconId 2 1 Address "112233445566778" 2 2 AlphaId "NO ICON" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F4 0C 54 65 73 74 20 4D 65 73 73 61 67 65
simatk SendTerminalResponse GeneralResult SuccessRequestedIconNotDisplayed
simatk WaitForRequest

// SEQ 3.2a
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 3021
waittestclass notify
simatk CheckProactiveCommand IconId 3 1 Address "112233445566778" 2 2 AlphaId "Send SM" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F4 0C 54 65 73 74 20 4D 65 73 73 61 67 65
simatk SendTerminalResponse
simatk WaitForRequest

// SEQ 3.2b
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 11 3022
waittestclass notify
simatk CheckProactiveCommand IconId 3 1 Address "112233445566778" 2 2 AlphaId "Send SM" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F4 0C 54 65 73 74 20 4D 65 73 73 61 67 65
simatk SendTerminalResponse GeneralResult SuccessRequestedIconNotDisplayed
simatk WaitForRequest

// close all
simatk Close SmsMessaging
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify
[Endtest]
