<?xml version="1.0" encoding="utf-8"?> 

<!--
MOD_0008.001_SIM_ATK_TSY_[REFRESH - normal]
MOD_0008.002_SIM_ATK_TSY_[REFRESH - IMSI changing procedure]
 -->


<isc-test-control id="8">


<!-- ******** -->
<!-- CHANNELS -->
<!-- ******** -->
<channels>
	<channel id="0x07"/>
</channels>


<!-- ****** -->
<!-- INPUTS -->
<!-- ****** -->
<inputs>


<!-- PROACTIVE COMMANDS -->
<!-- ****************** -->

<!-- 27.22.4.7.1 REFRESH (normal)  -->
    <input id="10101">
        <name>PCMD Refresh, 1.1.1</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,00,00,00,10,00,55,00,0D,D0,09,81,03,01,01,03,82,02,81,82,90,00</message>
    </input>
    
    <input id="10102">
        <name>PCMD Refresh, 1.2.1</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,00,00,00,10,00,55,00,16,D0,12,81,03,01,01,01,82,02,81,82,92,07,01,3F,00,7F,10,6F,3B,90,00</message>
    </input>

    <input id="10103">
        <name>PCMD Refresh, 1.3.1</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,00,00,00,10,00,55,00,16,D0,12,81,03,01,01,02,82,02,81,82,92,07,01,3F,00,7F,20,6F,30,90,00</message>
    </input>
    
    <input id="10104">
        <name>PCMD Refresh, 1.4.1</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,00,00,00,10,00,55,00,0D,D0,09,81,03,01,01,00,82,02,81,82,90,00</message>
    </input>

    <input id="10105">
        <name>PCMD Refresh, 1.5.1</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,00,00,00,10,00,55,00,0D,D0,09,81,03,01,01,04,82,02,81,82,90,00</message>
    </input>
    
    <!-- Seq 1.6 is not implemented, same as seq 1.1 -->

<!-- 27.22.4.7.2 REFRESH (IMSI changing procedure)  -->
    <input id="10201">
        <name>PROACTIVE COMMAND: REFRESH 2.1.1</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,00,00,00,10,00,55,00,22,D0,1E,81,03,01,01,02,82,02,81,82,92,13,03,3F,00,7F,20,6F,07,3F,00,7F,20,6F,7E,3F,00,7F,20,6F,20,90,00</message>
    </input>

    <input id="10202">
        <name>PROACTIVE COMMAND: REFRESH 2.2.1</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,00,00,00,10,00,55,00,0D,D0,09,81,03,01,01,00,82,02,81,82,90,00</message>
    </input>

    <input id="10203">
        <name>PROACTIVE COMMAND: REFRESH 2.3.1</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,00,00,00,10,00,55,00,0D,D0,09,81,03,01,01,04,82,02,81,82,90,00</message>
    </input>


<!-- SIM SERVER RESPONSES -->
<!-- ******************** -->

<!-- 27.22.4.7.1 REFRESH (normal)  -->
    <input id="30101">
        <name>SIM_ATK_RESP(REFRESH, SIM_STA_OK)</name>
        <direction>sos</direction>
        <message>00,00,00,09,00,00,00,00,00,E3,00,01,00,00,00,00</message>
    </input>
    
    <input id="30102">
        <name>SIM_ATK_RESP(REFRESH, SIM_STA_OK)</name>
        <direction>sos</direction>
        <message>00,00,00,09,00,00,00,00,00,E3,01,01,00,00,00,00</message>
    </input>
    
    <input id="30103">
        <name>SIM_ATK_RESP(REFRESH, SIM_STA_OK)</name>
        <direction>sos</direction>
        <message>00,00,00,09,00,00,00,00,00,E3,02,01,00,00,00,00</message>
    </input>

    <input id="30104">
        <name>SIM_ATK_RESP(REFRESH, SIM_STA_OK)</name>
        <direction>sos</direction>
        <message>00,00,00,09,00,00,00,00,00,E3,03,01,00,00,00,00</message>
    </input>

    <input id="30105">
        <name>SIM_ATK_RESP(REFRESH, SIM_STA_OK)</name>
        <direction>sos</direction>
        <message>00,00,00,09,00,00,00,00,00,E3,04,01,00,00,00,00</message>
    </input>
    

<!-- SIM SESSION END -->
<!-- *************** -->
    <input id="90004">
        <name>ATK_SW_DATA_NTF: PROACTIVE SIM SESSION ENDED</name>
        <direction>sos</direction>
        <message>00,00,00,5A,00,00,78,34,00,13,00,00,90,00,00,00</message>
    </input>
    
</inputs>


<!-- ******* -->
<!-- OUTPUTS -->
<!-- ******* -->
<outputs>

<!-- SIM SERVER REQUESTS -->
<!-- ******************* -->

<!-- 27.22.4.7.1 REFRESH (normal)  -->
    <output id="20101">
        <name>SIM_ATK_REQ(REFRESH, SIM Init)</name>
        <direction>dos</direction>
        <message>00,00,00,09,00,00,00,00,00,E2,00,00,00,00,00,00</message>
           <mask>00,00,00,FF,00,00,00,00,00,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>

    <output id="20102">
        <name>SIM_ATK_REQ(refresh, File Change Notification)</name>
        <direction>dos</direction>
        <message>00,00,00,09,00,1A,00,00,C7,E2,01,00,00,00,00,01,01,93,00,10,00,00,00,06,3F,00,7F,10,6F,3B,00,00</message>
           <mask>00,00,00,FF,00,00,00,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>    
    
    <output id="20103">
        <name>SIM_ATK_REQ(refresh, SIM Initialization and File Change Notification)</name>
        <direction>dos</direction>
        <message>00,00,00,09,00,1A,00,00,C7,E2,02,00,00,00,00,01,01,93,00,10,00,00,00,06,3F,00,7F,20,6F,30,00,00</message>
           <mask>00,00,00,FF,00,00,00,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>   
    
    <output id="20104">
        <name>SIM_ATK_REQ(REFRESH, SIM Initialization and Full File Change Notification)</name>
        <direction>dos</direction>
        <message>00,00,00,09,00,00,00,00,00,E2,03,00,00,00,00,00</message>
           <mask>00,00,00,FF,00,00,00,00,00,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>

    <output id="20105">
        <name>SIM_ATK_REQ(REFRESH, SIM Reset)</name>
        <direction>dos</direction>
        <message>00,00,00,09,00,00,00,00,00,E2,04,00,00,00,00,00</message>
           <mask>00,00,00,FF,00,00,00,00,00,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>

<!-- 27.22.4.7.2 REFRESH (IMSI changing procedure)  -->
    <output id="20201">
        <name>SIM_ATK_REQ(REFRESH, SIM Initialization and File Change Notification)</name>
        <direction>dos</direction>
        <message>00,00,10,09,00,3a,00,01,00,e2,02,00,00,00,00,03,01,93,00,10,00,00,00,06,3f,00,7f,20,6f,20,00,00,01,93,00,10,00,00,00,06,3f,00,7f,20,6f,7e,00,00,01,93,00,10,00,00,00,06,3f,00,7f,20,6f,07,00,00</message>
           <mask>00,00,00,FF,00,00,00,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>
    
<!-- TERMINAL RESPONSES -->
<!-- ****************** -->

<!-- 27.22.4.7.1 REFRESH (normal)  -->
    <output id="40101">
        <name>TERMINAL RESPONSE: REFRESH 1.1.1A</name>
        <direction>dos</direction>
        <message>1D,00,10,5A,00,16,00,00,00,11,00,00,00,0C,81,03,01,01,03,02,02,82,81,03,01,00,00,00</message>
           <mask>00,00,00,FF,00,00,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>
    
    <output id="40102">
        <name>REFRESH 1.2.1B</name>
        <direction>dos</direction>
        <message>1D,00,10,5A,00,16,00,00,00,11,00,00,00,0C,81,03,01,01,01,82,02,82,81,83,01,03,00,00</message>
           <mask>00,00,00,FF,00,00,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,FF,FF</mask>
    </output>
	
    <output id="40103">
        <name>REFRESH 1.3.1A</name>
        <direction>dos</direction>
        <message>1D,00,10,5A,00,16,00,00,00,11,00,00,00,0C,81,03,01,01,02,82,02,82,81,83,01,00,00,00</message>
           <mask>00,00,00,FF,00,00,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,FF,FF</mask>

    </output>

    <output id="40104">
        <name>REFRESH 1.4.1A</name>
        <direction>dos</direction>
        <message>1D,00,10,5A,00,16,00,00,00,11,00,00,00,0C,81,03,01,01,00,82,02,82,81,83,01,00,00,00</message>
           <mask>00,00,00,FF,00,00,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,FF,FF</mask>
    </output>

    <output id="40105">
        <name>REFRESH Empty TR which is not passed to SIM</name>
        <direction>dos</direction>
        <message>00,00,00,5A,00,0A,00,00,00,11,00,00,00,00,00,00</message>
           <mask>00,00,00,FF,00,FF,00,00,FF,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>

<!-- 27.22.4.7.2 REFRESH (IMSI changing procedure)  -->
    <output id="40201">
        <name>TERMINAL RESPONSE: REFRESH 2.1.1A</name>
        <direction>dos</direction>
        <message>1D,00,10,5A,00,16,00,00,00,11,00,00,00,0C,81,03,01,01,02,82,02,82,81,83,01,00,00,00</message>
           <mask>00,00,00,FF,00,FF,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,FF,FF</mask>
    </output>
    
    <output id="40202">
        <name>TERMINAL RESPONSE: REFRESH 2.2.1B</name>
        <direction>dos</direction>
        <message>1D,00,10,5A,00,16,00,00,00,11,00,00,00,0C,81,03,01,01,00,82,02,82,81,83,01,03,00,00</message>
           <mask>00,00,00,FF,00,FF,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,FF,FF</mask>
    </output>
    	
</outputs>


<!-- ********** -->
<!-- TEST STEPS -->
<!-- ********** -->
<steps>


<!-- PROACTIVE COMMANDS -->
<!-- ****************** -->

<!-- 27.22.4.7.1 REFRESH (normal)  -->
    <step id="10101" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10101"/>
    </step>

    <step id="10102" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10102"/>
    </step>

    <step id="10103" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10103"/>
    </step>

    <step id="10104" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10104"/>
    </step>
    
    <step id="10105" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10105"/>
    </step>

<!-- 27.22.4.7.2 REFRESH (IMSI changing procedure)  -->
    <step id="10201" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10201"/>
    </step>

    <step id="10202" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10202"/>
    </step>

    <step id="10203" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10203"/>
    </step>

<!-- SIM SERVER REQUESTS -->
<!-- ******************* -->

<!-- 27.22.4.7.1 REFRESH (normal)  -->
    <step id="20101" type="intercept">
        <name>Intercept SIM_ATK_REQ</name>
        <channel id="0x07"/>
        <output-ref id="20101"/>
    </step>

    <step id="20102" type="intercept">
        <name>Intercept SIM_ATK_REQ</name>
        <channel id="0x07"/>
        <output-ref id="20102"/>
    </step>

    <step id="20103" type="intercept">
        <name>Intercept SIM_ATK_REQ</name>
        <channel id="0x07"/>
        <output-ref id="20103"/>
    </step>

    <step id="20104" type="intercept">
        <name>Intercept SIM_ATK_REQ</name>
        <channel id="0x07"/>
        <output-ref id="20104"/>
    </step>

    <step id="20105" type="intercept">
        <name>Intercept SIM_ATK_REQ</name>
        <channel id="0x07"/>
        <output-ref id="20105"/>
    </step>
    
<!-- 27.22.4.7.2 REFRESH (IMSI changing procedure)  -->
    <step id="20201" type="intercept">
        <name>Intercept SIM_ATK_REQ</name>
        <channel id="0x07"/>
        <output-ref id="20201"/>
    </step>

        
<!-- SIM SERVER RESPONSES -->
<!-- ******************** -->

<!-- 27.22.4.7.1 REFRESH (normal)  -->
    <step id="30101" type="simulate">
        <name>Send SIM_ATK_RESP</name>
        <channel id="0x07"/>
        <input-ref id="30101"/>
    </step>
    
    <step id="30102" type="simulate">
        <name>Send SIM_ATK_RESP</name>
        <channel id="0x07"/>
        <input-ref id="30102"/>
    </step>

    <step id="30103" type="simulate">
        <name>Send SIM_ATK_RESP</name>
        <channel id="0x07"/>
        <input-ref id="30103"/>
    </step>

    <step id="30104" type="simulate">
        <name>Send SIM_ATK_RESP</name>
        <channel id="0x07"/>
        <input-ref id="30104"/>
    </step>

    <step id="30105" type="simulate">
        <name>Send SIM_ATK_RESP</name>
        <channel id="0x07"/>
        <input-ref id="30105"/>
    </step>


<!-- TERMINAL RESPONSES -->
<!-- ****************** -->

<!-- 27.22.4.7.1 REFRESH (normal)  -->
    <step id="40101" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="40101"/>
        <flags>0x40</flags>
    </step>

    <step id="40102" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="40102"/>
        <flags>0x40</flags>
    </step>

    <step id="40103" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="40103"/>
        <flags>0x40</flags>
    </step>

    <step id="40104" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="40104"/>
        <flags>0x40</flags>
    </step>

    <step id="40105" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="40105"/>
        <flags>0x40</flags>
    </step>

<!-- 27.22.4.7.2 REFRESH (IMSI changing procedure)  -->
    <step id="40201" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="40201"/>
        <flags>0x40</flags>
    </step>
	
    <step id="40202" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="40202"/>
        <flags>0x40</flags>
    </step>
	
<!-- GENERAL STEPS -->
<!-- ************* -->

    <step id="90001" type="sync">
        <name>Sync with test env</name>
        <flags>1</flags>  <!-- Ignore unexpected messages  -->
    </step>

    <step id="90002" type="open-channel">
        <name>Attach to channel 7</name>
        <channel id="0x07"/>
    </step>

    <step id="90003" type="close-channel">
        <name>Detach from channel 7</name>
        <channel id="0x07"/>
    </step>
    
    <step id="90004" type="simulate">
        <name>SIM session end</name>
        <channel id="0x07"/>
        <input-ref id="90004"/>
        <flags>0x40</flags>  <!-- Use stored transaction ID in simulated message -->        
    </step>
        
</steps>


<!-- ********** -->
<!-- TEST CASES -->
<!-- ********** -->
<cases>

<!-- 27.22.4.7.1 REFRESH (normal)  -->

    <case id="101">
        <name>Sequence 1.1 (REFRESH, SIM Initialization)</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10101"/> <!-- Send PCMD -->
            <step-ref id="20101"/> <!-- check refresh -->
            <step-ref id="30101"/> <!-- SIMSON's response -->
            <step-ref id="40101"/> <!-- Terminal response -->
			<step-ref id="90004"/> <!-- SimSessionEnd -->
        </test-steps>
    </case>
    
    <case id="102">
        <name>Sequence 1.2 (REFRESH, File Change Notification)</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10102"/> <!-- Send PCMD -->
            <step-ref id="20102"/> <!-- Receive SIM_ATK_REQ -->
            <step-ref id="30102"/> <!-- Send SIM_ATK_RESP -->
            <step-ref id="40102"/> <!-- Receive TR -->
			<step-ref id="90004"/> <!-- SimSessionEnd -->
        </test-steps>
    </case>
    
    <case id="103">
        <name>Sequence 1.3 (REFRESH, SIM Initialization and File Change Notification)</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10103"/> <!-- Send PCMD -->
            <step-ref id="20103"/> <!-- Receive SIM_ATK_REQ -->
            <step-ref id="30103"/> <!-- Send SIM_ATK_RESP -->
            <step-ref id="40103"/> <!-- Receive TR -->
			<step-ref id="90004"/> <!-- SimSessionEnd -->
        </test-steps>
    </case>

    <case id="104">
        <name>Sequence 1.4 (REFRESH, SIM Initialization and Full File Change Notification)</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10104"/> <!-- Send PCMD -->
            <step-ref id="20104"/> <!-- Receive SIM_ATK_REQ -->
            <step-ref id="30104"/> <!-- Send SIM_ATK_RESP -->
            <step-ref id="40104"/> <!-- Receive TR -->
			<step-ref id="90004"/> <!-- SimSessionEnd -->
        </test-steps>
    </case>

    <case id="105">
        <name>Sequence 1.5 (REFRESH, SIM Reset)</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10105"/> <!-- Send PCMD -->
            <step-ref id="20105"/> <!-- Receive SIM_ATK_REQ -->
            <step-ref id="30105"/> <!-- Send SIM_ATK_RESP -->
            <step-ref id="40105"/> <!-- Receive empty TR -->
        </test-steps>
    </case>
    
    <!-- Seq 1.6 is not implemented, same as seq 1.1 -->

<!-- 27.22.4.7.2 REFRESH (IMSI changing procedure)  -->
    <case id="201">
        <name>Sequence 2.1 (REFRESH, SIM Initialization and File Change Notification)</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10201"/> <!-- Send PCMD -->
            <step-ref id="20201"/> <!-- check refresh -->
            <step-ref id="30102"/> <!-- SIMSON's response -->
            <step-ref id="40201"/> <!-- Terminal response -->
			<step-ref id="90004"/> <!-- SimSessionEnd -->
        </test-steps>
    </case>
    
    <case id="202">
        <name>Sequence 2.2 (REFRESH, SIM Initialization and Full File Change Notification)</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10202"/> <!-- Send PCMD -->
            <step-ref id="20104"/> <!-- check refresh -->
            <step-ref id="30104"/> <!-- SIMSON's response -->
            <step-ref id="40202"/> <!-- Terminal response -->
			<step-ref id="90004"/> <!-- SimSessionEnd -->
        </test-steps>
    </case>
    
    <case id="203">
        <name>Sequence 2.3 (REFRESH, SIM Reset)</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="10203"/> <!-- Send PCMD -->
            <step-ref id="20105"/> <!-- Receive SIM_ATK_REQ -->
            <step-ref id="30105"/> <!-- Send SIM_ATK_RESP -->
            <step-ref id="40105"/> <!-- Receive empty TR -->
        </test-steps>
    </case>
    
</cases>

</isc-test-control>
