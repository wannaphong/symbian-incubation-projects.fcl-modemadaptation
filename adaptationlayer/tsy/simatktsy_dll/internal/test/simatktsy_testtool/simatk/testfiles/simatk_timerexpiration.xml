<?xml version="1.0" encoding="utf-8"?> 

<!-- MOD_0019.001_SIM_ATK_TSY_[ENVELOPE TIMER EXPIRATION - Normal] -->


<isc-test-control id="19">


<!-- ******** -->
<!-- CHANNELS -->
<!-- ******** -->
<channels>
	<channel id="0x07"/>
</channels>


<!-- ****** -->
<!-- INPUTS -->
<!-- ****** -->
<inputs>


<!-- PROACTIVE COMMANDS -->
<!-- ****************** -->
   
    <input id="10031">
        <name>PROACTIVE COMMAND: TIMER MANAGEMENT 2.1.1</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,08,00,00,10,00,55,00,15,D0,11,81,03,01,27,00,82,02,81,82,A4,01,01,A5,03,00,00,01,90,00</message>
    </input>
    
    <input id="10032">
        <name>PROACTIVE COMMAND: TIMER MANAGEMENT 2.2.1</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,08,00,00,10,00,55,00,15,D0,11,81,03,01,27,00,82,02,81,82,A4,01,01,A5,03,00,00,03,90,00</message>
    </input>
    
<!-- SIM SESSION END -->
<!-- *************** -->
    <input id="90004">
        <name>SIM Session End</name>
        <direction>sos</direction>
        <message>00,00,00,5A,00,00,78,34,00,13,00,00,90,00,00,00</message>
        <!-- Transaction Id's (9:th byte) must match with Terminal responses transaction id -->
    </input>

<!-- SIM BUSY -->
<!-- ******** -->

    <input id="90005">
        <name>SIM Busy</name>
        <direction>sos</direction>
        <message>00,00,00,5A,00,00,78,34,00,13,00,00,93,00,00,00</message>
        <!-- Transaction Id's (9:th byte) must match with Envelopes transaction id -->
    </input>

<!-- PROACTIVE COMMAND PENDING -->
<!-- ************************* -->

    <input id="90010">
        <name>SIM Command pending</name>
        <direction>sos</direction>
        <message>00,00,00,5A,00,00,78,34,C5,13,00,00,91,00,00,00</message>
        <!-- Transaction Id's (9:th byte) must match with Envelopes transaction id -->
    </input>

</inputs>

<!-- ******* -->
<!-- OUTPUTS -->
<!-- ******* -->
<outputs>

<!-- ENVELOPES -->
<!-- ********* -->

    <output id="20001">
        <name>ENVELOPE: TIMER EXPIRATION 2.1.1</name>
        <direction>dos</direction>
        <message>00,00,00,5A,00,16,00,00,C5,12,00,0E,D7,0C,82,02,82,81,A4,01,01,A5,03,00,00,01,00,00</message>
           <mask>00,00,00,FF,00,FF,00,00,00,FF,FF,FF,FF,FF,7F,FF,FF,7F,7F,FF,FF,7F,FF,FF,FF,FF,FF,FF</mask>
    </output>
    
    <output id="20002">
        <name>ENVELOPE: TIMER EXPIRATION 2.2.1</name>
        <direction>dos</direction>
        <message>00,00,00,5A,00,16,00,00,00,12,00,0E,D7,0C,82,02,82,81,A4,01,01,A5,03,00,00,03,00,00</message>
           <mask>00,00,00,FF,00,FF,00,00,00,FF,FF,FF,FF,FF,7F,FF,FF,7F,7F,FF,FF,7F,FF,FF,FF,0F,FF,FF</mask>
    </output>
    
<!-- TERMINAL RESPONSES -->
<!-- ****************** -->
   
    <output id="40017">
        <name>TERMINAL RESPONSE: TIMER MANAGEMENT 2.1.1</name>
        <direction>dos</direction>
        <message>1D,00,10,5A,00,1A,00,08,00,11,00,00,00,0F,81,03,01,27,00,82,02,82,81,83,01,00,A4,01,01,00,00,00</message>
           <mask>00,00,00,FF,00,FF,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,7F,FF,FF,FF,FF,FF</mask>
    </output>
    
    <output id="40018">
        <name>TERMINAL RESPONSE: TIMER MANAGEMENT 2.2.1</name>
        <direction>dos</direction>
        <message>1D,00,10,5A,00,1A,00,08,00,11,00,00,00,0F,81,03,01,27,00,82,02,82,81,83,01,00,A4,01,01,00,00,00</message>
           <mask>00,00,00,FF,00,FF,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,7F,FF,FF,FF,FF,FF</mask>
    </output>
    
</outputs>

<!-- ********** -->
<!-- TEST STEPS -->
<!-- ********** -->
<steps>

<!-- PROACTIVE COMMANDS -->
<!-- ****************** -->   

    <step id="10031" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10031"/>
    </step>
    
    <step id="10032" type="simulate">
        <name>Send PCMD</name>
        <channel id="0x07"/>
        <input-ref id="10032"/>
    </step>
    

<!-- ENVELOPES -->
<!-- ********* -->

    <step id="20001" type="intercept">
        <name>Intercept Envelope</name>
        <channel id="0x07"/>
        <output-ref id="20001"/>
        <flags>0x40</flags>  <!-- Store transaction ID from intercepted message -->
    </step>
    
    <step id="20002" type="intercept">
        <name>Intercept Envelope</name>
        <channel id="0x07"/>
        <output-ref id="20002"/>
        <flags>0x40</flags>  <!-- Store transaction ID from intercepted message -->
    </step>
    
<!-- TERMINAL RESPONSES -->
<!-- ****************** -->
    
    <step id="40017" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="40017"/>
        <flags>0x40</flags>  <!-- Store transaction ID from intercepted message -->
    </step>

    <step id="40018" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="40018"/>
        <flags>0x40</flags>  <!-- Store transaction ID from intercepted message -->
    </step>
    
<!-- GENERAL STEPS -->
<!-- ************* -->

    <step id="90001" type="sync">
        <name>Sync with test env</name>
    </step>

    <step id="90002" type="open-channel">
        <name>Attach to channel 7</name>
        <channel id="0x07"/>
    </step>

    <step id="90003" type="close-channel">
        <name>Detach from channel 7</name>
        <channel id="0x07"/>
    </step>

    <step id="90004" type="simulate">
        <name>SIM session end</name>
        <channel id="0x07"/>
        <input-ref id="90004"/>
        <flags>0x40</flags>  <!-- Use stored transaction ID in simulated message -->        
    </step>

    <step id="90005" type="simulate">
        <name>SIM BUSY</name>
        <channel id="0x07"/>
        <input-ref id="90005"/>
        <flags>0x40</flags>  <!-- Use stored transaction ID in simulated message -->        
    </step>

    <step id="90010" type="simulate">
        <name>SIM session end, command pending</name>
        <channel id="0x07"/>
        <input-ref id="90010"/>
        <flags>0x40</flags>  <!-- Use stored transaction ID in simulated message -->        
    </step>

</steps>

<!-- ********** -->
<!-- TEST CASES -->
<!-- ********** -->
<cases>

    <case id="201">
        <name>Sequence 2.1 (TIMER EXPIRATION, pending proactive SIM command)</name>
        <timeout>20</timeout>
        <test-steps>
            <step-ref id="90002"/> <!-- Attach to channel 7 -->
            
            <step-ref id="10031"/> <!-- Send PCMD -->
            <step-ref id="40017"/> <!-- Receive TR -->
            <step-ref id="20001"/> <!-- Receive Envelope -->
            <step-ref id="90010"/> <!-- Send SIM session end, command pending -->
            
            <step-ref id="90003"/> <!-- Detach from channel 7 -->
        </test-steps>
    </case>

    <case id="202">
        <name>Sequence 2.2 (TIMER EXPIRATION, SIM application toolkit busy)</name>
        <timeout>60</timeout>
        <test-steps>
            <step-ref id="90002"/> <!-- Attach to channel 7 -->
            
            <step-ref id="10032"/> <!-- Send PCMD -->
            <step-ref id="40018"/> <!-- Receive TR -->
            <step-ref id="90004"/> <!-- SimSessionEnd -->
            
            <step-ref id="20002"/> <!-- Receive Envelope -->
            <step-ref id="90005"/> <!-- SIM busy -->
            <step-ref id="20002"/> <!-- Receive Envelope -->
            <step-ref id="90005"/> <!-- SIM busy -->
            <step-ref id="20002"/> <!-- Receive Envelope -->
            <step-ref id="90005"/> <!-- SIM busy -->
            <step-ref id="20002"/> <!-- Receive Envelope -->
            <step-ref id="90005"/> <!-- SIM busy -->
            <step-ref id="20002"/> <!-- Receive Envelope -->
            <step-ref id="90005"/> <!-- SIM busy -->
            <step-ref id="20002"/> <!-- Receive Envelope -->
            <step-ref id="90005"/> <!-- SIM busy -->
            <step-ref id="20002"/> <!-- Receive Envelope -->
            <step-ref id="90005"/> <!-- SIM busy -->
            <step-ref id="20002"/> <!-- Receive Envelope -->
            <step-ref id="90005"/> <!-- SIM busy -->
            <step-ref id="20002"/> <!-- Receive Envelope -->
            <step-ref id="90005"/> <!-- SIM busy -->
            <step-ref id="20002"/> <!-- Receive Envelope -->
            <step-ref id="90004"/> <!-- SIM session end -->
            
            <step-ref id="90003"/> <!-- Detach from channel 7 -->
        </test-steps>
    </case>

</cases>

</isc-test-control>