//* Copyright (c) 2009 Nokia Corporation and/or its subsidiary(-ies).
//* All rights reserved.
//* This component and the accompanying materials are made available
//* under the terms of the License "Eclipse Public License v1.0"
//* which accompanies this distribution, and is available
//* at the URL "http://www.eclipse.org/legal/epl-v10.html".
//*
//* Initial Contributors:
//* Nokia Corporation - initial contribution.
//*
//* Contributors:
//*
//* Description:  

//
// Precondition:
// - Detailed description can be found from Quality Center's Project: CoreSW_CASW/Module Tests/SIM ATK TSY/SimAtkTSY_testtool
//
// Script description:

// Proactive command //
///////////////////////

// AlphaId (Optional)
//  Enter the text inside the quotes or as unicode hex digits. Example: AlphaId "abc" or AlphaId 61 62 63

// Address
//  Enter the destination number inside the quotes
//  TypeOfNumber (Optional, default = 1, UnknownNumber)
//      0 TypeOfNumberNotSet, initialization value used within constructor(s).
//      1 UnknownNumber, the user or the network has no knowledge of the type of network.
//      2 InternationalNumber, international number.
//      3 NationalNumber, national number.
//      4 NetworkSpecificNumber, administration/service number specific to the serving network,
//        e.g. used to access an operator.
//      5 DedicatedNumber, called dedicated access / short code in GSM/WCDMA. Corresponds to
//        TMobileTON::ESubscriberNumber in ETel MM API.
//      6 AlphanumericNumber, alphanumeric number.
//      7 EAbbreviatedNumber, abbreviated number.
//  NumberingPlan (Optional, default = 1, UnknownNumberingPlan)
//      0 NumberingPlanNotSet, initialization value used within constructor(s).
//      1 UnknownNumberingPlan, the user or the network has no knowledge of the numbering plan.
//      2 IsdnNumberPlan, ISDN / telephony numbering plan.
//      3 DataNumberPlan, data numbering plan.
//      4 TelexNumberPlan, telex numbering plan.
//      5 ServiceCentreSpecificPlan1, The service centre specific plan is used to indicate a numbering
//        plan specific to External Short Message Entities attached to the SMS centre.
//      6 ServiceCentreSpecificPlan2, the service centre specific plan is used to indicate a numbering
//        plan specific to External Short Message Entities attached to the SMS centre.
//      7 NationalNumberPlan, national numbering plan.
//      8 PrivateNumberPlan, private numbering plan.
//      9 ERMESNumberPlan, ERMES numbering plan.
// Example (Number "123456789", InternationalNumber, DataNumberPlan):
// Address "123456789" 2 3
// NOTE! Address field has two different functionalities in SendSm-command. If proactive command provides
// SMSC, the address field is used to validate the SMSC. However, if SMSC is missing from proactive command,
// the address field is used as a phone's default SMSC and it shall be used when sending SM with
// "no logging" -function.

// IconId (Optional, default = IconId 0 0)
//  IconQualifier
//      0 NotSet
//      1 NoIconId
//      2 SelfExplanatory
//      3 NotSelfExplanatory
//  IconIdentifier
//      Id number
//  Example SelfExplanatory ID 5: IconId 2 5

// SmsTpdu
//  Messages SMSTPDU block in hexadecimal numbers
//  Example: SmsTpdu 01 00 09 91 10 32 54...

// SmsResult (Optional, default = 0, KErrNone )
//  Defines expected return value for SendMessageNoLogging method
//  Example: SmsResult -8302


// Terminal Response //
///////////////////////

// GeneralResult
//  General result of the proactive command. Default command performed successfully.

// AdditionalInfo
//  Enter the text inside the quotes or as unicode hex digits

// InfoType
// If the value of iGeneralResult requires additional information,
// set this to MeProblem (2).  Otherwise set to
// NoAdditionalInfo (1). Default no additional info.


[Test]
title MOD_1011.001_SIM_ATK_TSY_[SEND SHORT MESSAGE - normal, packing required - with header data]

create SimAtk simatk
create SimAtkNotify notify

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl
simatk Open SmsMessaging

// Load ISC XML -file
simatk LoadIscTests SimAtk_SendSm_custom.xml

notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 1011 101
waittestclass notify

// PCmd doesn't include SMSC Address
// so address is included and used as a phone's default SMSC and it shall be used when sending SM with
// "no logging" -function.
simatk CheckProactiveCommand Address "358508771010" 2 2 AlphaId "Env. msg 01..." SmsTpdu 51 00 0B 81 10 91 56 68 07 F7 00 00 A7 0C 05 00 03 00 01 01 A8 E5 39 BD 0C
simatk SendTerminalResponse
simatk WaitForRequest

// close all
simatk Close SmsMessaging
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify
[Endtest]

// MOD_1011.002_SIM_ATK_TSY_[SEND SHORT MESSAGE - normal, invalid user data length]
//
// Precondition:
// - Detailed description can be found from Quality Center's Project: CoreSW_CASW/Module Tests/SIM ATK TSY/SimAtkTSY_testtool
//
// Script description:
// - This test case is implemented for verirying SUB 403-8042: SAT:Validity check of address field in SEND SMS proacive command.
//   Invalid user data length is used in TPDU (given in xml-file), test case should return value KErrCorrupt (-20)

[Test]
title MOD_1011.002_SIM_ATK_TSY_[SEND SHORT MESSAGE - normal, invalid user data length]

create SimAtk simatk
create SimAtkNotify notify

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl
simatk Open SmsMessaging

// Load ISC XML -file
simatk LoadIscTests SimAtk_SendSm_custom.xml

notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 1011 102
allownextresult -20
waittestclass notify
simatk WaitForRequest

// close all
simatk Close SmsMessaging
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify
[Endtest]

// MOD_1011.003_SIM_ATK_TSY_[SEND SHORT MESSAGE - normal, with validity period]
//
// Precondition:
// - Detailed description can be found from Quality Center's Project: CoreSW_CASW/Module Tests/SIM ATK TSY/SimAtkTSY_testtool
//
// Script description:
// - This test case verifies that different validity period formats are handled correctly.

[Test]
title MOD_1011.003_SIM_ATK_TSY_[SEND SHORT MESSAGE - normal, with validity period]

create SimAtk simatk
create SimAtkNotify notify

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl
simatk Open SmsMessaging

// Load ISC XML -file
simatk LoadIscTests SimAtk_SendSm_custom.xml

// Validity period relative
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 1011 103
allownextresult 0
waittestclass notify
simatk SendTerminalResponse
simatk WaitForRequest

// Validity period enhanced
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 1011 104
allownextresult 0
waittestclass notify
simatk SendTerminalResponse
simatk WaitForRequest

// Validity period absolute
notify UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 1011 105
allownextresult 0
waittestclass notify
simatk SendTerminalResponse
simatk WaitForRequest

// close all
simatk Close SmsMessaging
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify
[Endtest]
