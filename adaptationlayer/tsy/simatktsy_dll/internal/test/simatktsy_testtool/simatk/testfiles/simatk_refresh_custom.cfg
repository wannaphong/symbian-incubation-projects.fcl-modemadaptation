//* Copyright (c) 2009 Nokia Corporation and/or its subsidiary(-ies).
//* All rights reserved.
//* This component and the accompanying materials are made available
//* under the terms of the License "Eclipse Public License v1.0"
//* which accompanies this distribution, and is available
//* at the URL "http://www.eclipse.org/legal/epl-v10.html".
//*
//* Initial Contributors:
//* Nokia Corporation - initial contribution.
//*
//* Contributors:
//*
//* Description:  


// *********************************
// CheckProactiveCommand parameters:
// *********************************
// RefreshType (Mandatory)
// 0    ///< not set 
// 1    ///< SIM or USIM Initialization and Full File Change Notification.
// 2	///< SIM or USIM File Change Notification.
// 3	///< SIM or USIM Initialization and File Change Notification.
// 4    ///< SIM or USIM Initialization.
// 5	///< GSM SIM or UICC Reset.
// 6	///< USIM Application Reset.
// 7	///< 3G Session Reset.

// FileList (optional)
// empty or missing == no files
// Eg. FileList 6F38 6F33 6F22

// AID (Optional)
// empty or missing == not set
// Eg. AID A0 00 00 00 01 A1 A2 A3

[Test]
title MOD_1005.001_SIM_ATK_TSY_[REFRESH - USIM application reset]

create SimAtk simatk
create SimAtkNotify notify1
create SimAtkNotify notify2

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

simatk LoadIscTests SimAtk_Refresh_custom.xml

// USIM application reset:
print "Extra seq: USIM Application reset"
notify1 UseObjectAddress simatk ESatNotifyRefreshRequiredParam
notify2 UseObjectAddress simatk ESatNotifyRefreshPCmd
simatk RunIscTestCase 1005 101
waittestclass notify1
// check type of refresh
simatk CheckProactiveCommand RefreshType 06
// Send RefreshAllowed
simatk SendTerminalResponse CommandType ESatNotifyRefreshRequiredParam
// wait until PCMD is received
waittestclass notify2
// Send terminal response for proactive command
simatk SendTerminalResponse CommandType ESatNotifyRefreshPCmd 
// wait until ISC test case is completed
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify1
delete notify2
[Endtest]


[Test]
title MOD_1005.002_SIM_ATK_TSY_[REFRESH - 3G Session reset]

create SimAtk simatk
create SimAtkNotify notify1
create SimAtkNotify notify2

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

simatk LoadIscTests SimAtk_Refresh_custom.xml

// 3G Session reset:
print "Extra seq: 3G Session reset"
notify1 UseObjectAddress simatk ESatNotifyRefreshRequiredParam
notify2 UseObjectAddress simatk ESatNotifyRefreshPCmd
simatk RunIscTestCase 1005 102
waittestclass notify1
// check type of refresh
// EF-SMSP
simatk CheckProactiveCommand RefreshType 07 FileList 6F42
// Send RefreshAllowed
simatk SendTerminalResponse CommandType ESatNotifyRefreshRequiredParam
// wait until PCMD is received
waittestclass notify2
// Send terminal response for proactive command
simatk SendTerminalResponse CommandType ESatNotifyRefreshPCmd 
// wait until ISC test case is completed
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify1
delete notify2
[Endtest]


[Test]
title MOD_1005.003_SIM_ATK_TSY_[REFRESH - Empty File List TLV with TLV length zero]

create SimAtk simatk
create SimAtkNotify notify1
create SimAtkNotify notify2

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

simatk LoadIscTests SimAtk_Refresh_custom.xml

// USIM Initialization and Full File Change Notification:
print "Extra seq: USIM Initialization and Full File Change Notification"
notify1 UseObjectAddress simatk ESatNotifyRefreshRequiredParam
notify2 UseObjectAddress simatk ESatNotifyRefreshPCmd
simatk RunIscTestCase 1005 103
waittestclass notify1
// check type of refresh
// Empty FileList
simatk CheckProactiveCommand RefreshType 01 FileList ""
// Send RefreshAllowed
simatk SendTerminalResponse CommandType ESatNotifyRefreshRequiredParam
// wait until PCMD is received
waittestclass notify2
// Send terminal response for proactive command
simatk SendTerminalResponse CommandType ESatNotifyRefreshPCmd 
// wait until ISC test case is completed
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify1
delete notify2
[Endtest]
