//* Copyright (c) 2009 Nokia Corporation and/or its subsidiary(-ies).
//* All rights reserved.
//* This component and the accompanying materials are made available
//* under the terms of the License "Eclipse Public License v1.0"
//* which accompanies this distribution, and is available
//* at the URL "http://www.eclipse.org/legal/epl-v10.html".
//*
//* Initial Contributors:
//* Nokia Corporation - initial contribution.
//*
//* Contributors:
//*
//* Description:  

//
// Precondition: 
// - Detailed description can be found from Quality Center's Project: CoreSW_CASW/Module Tests/SIM ATK TSY/SimAtkTSY_testtool
//
// Script description:
//
// Following design descisions of SIM_ATK_TSY are followed when these test cases 
// were created:
// - NotifyMoSmControlRequest is only completed when SIM provides an AlphaID
// - In out of network coverage situtaution SMS sending is allowed without 
//   asking from SIM.

// MO SMS Control Result //
///////////////

// ControlResult
//  0 EControlResultNotSet, Initialization value used within constructor(s)
//  1 EAllowedNoModification
//  2 ENotAllowed
//  3 EAllowedWithModifications

// AlphaId
//  Enter the text inside the quotes or as unicode hex digits. Example: Text "abc" or Text 61 62 63

[Test]
title MOD_1004.001_SIM_ATK_TSY_[MO SMS Control - out of network coverage]

create SimAtk simatk

simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open IscControl
simatk LoadIscTests SimAtk_MoSmsControl_custom.xml
simatk Open SAT

simatk RunIscTestCase 1004 101
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
[Endtest]

[Test]
title MOD_1004.002_SIM_ATK_TSY_[MO SMS Control - Long Alpha ID]

create SimAtk simatk
create SimAtkNotify notifyMoSmsControl

simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open IscControl
simatk LoadIscTests SimAtk_MoSmsControl_custom.xml
simatk Open SAT

notifyMoSmsControl UseObjectAddress simatk ESatNotifyMoSmControlRequest
simatk RunIscTestCase 1004 102
waittestclass notifyMoSmsControl 
simatk CheckProactiveCommand ControlResult 01 AlphaId "MO SM control gives the following response containing this very looong alpha identifier though this may be truncated by the mobile equipment!! The length is 250!!! The length is 250!!! The length is 250!!! The length is 250!!! The length is 25"
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notifyMoSmsControl
delete simatk
[Endtest]

[Test]
title MOD_1004.003_SIM_ATK_TSY_[MO SMS Control - Extented Cell ID]

create SimAtk simatk
create SimAtkNotify notifySendSm

// Open ETel and related services
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open SmsMessaging

// For ISI-message simulation and analysis
simatk Open IscControl
simatk LoadIscTests SimAtk_MoSmsControl_custom.xml


// Allowed
notifySendSm UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 1004 103
waittestclass notifySendSm
simatk CheckProactiveCommand Address "112233445566778" 2 2 AlphaId "Send SM" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F4 0C 54 65 73 74 20 4D 65 73 73 61 67 65
simatk SendTerminalResponse
simatk WaitForRequest

// Not allowed case
notifySendSm UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 1004 104
waittestclass notifySendSm
simatk CheckProactiveCommand Address "112233445566778" 2 2 AlphaId "Send SM" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F4 0C 54 65 73 74 20 4D 65 73 73 61 67 65 SmsResult -8301
simatk SendTerminalResponse GeneralResult 39 InfoType MeProblem AdditionalInfo 01
simatk WaitForRequest

// Allowed with modifications
notifySendSm UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 1004 105
waittestclass notifySendSm
simatk CheckProactiveCommand Address "112233445566778" 2 2 AlphaId "Send SM" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F4 0C 54 65 73 74 20 4D 65 73 73 61 67 65 SmsResult -8302
simatk SendTerminalResponse
simatk WaitForRequest

// Allowed, "90 00" no modifications
notifySendSm UseObjectAddress simatk ESatNotifySendSmPCmd
simatk RunIscTestCase 1004 106
waittestclass notifySendSm
simatk CheckProactiveCommand Address "112233445566778" 2 2 AlphaId "Send SM" SmsTpdu 01 00 09 91 10 32 54 76 F8 40 F4 0C 54 65 73 74 20 4D 65 73 73 61 67 65
simatk SendTerminalResponse 
simatk WaitForRequest

// close all
simatk Close SmsMessaging
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notifySendSm
delete simatk
[Endtest]

