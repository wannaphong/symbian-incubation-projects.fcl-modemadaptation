//* Copyright (c) 2009 Nokia Corporation and/or its subsidiary(-ies).
//* All rights reserved.
//* This component and the accompanying materials are made available
//* under the terms of the License "Eclipse Public License v1.0"
//* which accompanies this distribution, and is available
//* at the URL "http://www.eclipse.org/legal/epl-v10.html".
//*
//* Initial Contributors:
//* Nokia Corporation - initial contribution.
//*
//* Contributors:
//*
//* Description:  

// Precondition: 
// - Detailed description can be found from Quality Center's Project: CoreSW_CASW/Module Tests/SIM ATK TSY/SimAtkTSY_testtool
//
// Script description:

// Proactive command //
///////////////////////

// AlphaId (Optional)
//  Enter the text inside the quotes or as unicode hex digits. Example: AlphaId "abc" or AlphaId 61 62 63

// IconId (Optional, default = IconId 0 0)
//  IconQualifier
//      0 NotSet
//      1 NoIconId
//      2 SelfExplanatory
//      3 NotSelfExplanatory
//  IconIdentifier
//      Id number
//  Example SelfExplanatory ID 5: IconId 2 5

// UssdString
//  Enter the text inside the quotes or as unicode hex digits. Example: AlphaId "abc" or AlphaId 61 62 63

// Dcs (Optional, default = 0x00)
// DataCoding scheme for USSD.
//  Enter the used data coding scheme as hexadicimal value

// Terminal Response //
///////////////////////

// GeneralResult
//  General result of the proactive command. Default command performed successfully.

// GeneralResult2
//  General result of the proactive command. Default command performed successfully.

// AdditionalInfo
//  Enter the text inside the quotes or as unicode hex digits

// AdditionalInfo2
//  Enter the text inside the quotes or as unicode hex digits

// InfoType
// If the value of iGeneralResult requires additional information,
// set this to MeProblem (2).  Otherwise set to
// NoAdditionalInfo (1). Default no additional info.

// InfoType2
// If the value of iGeneralResult requires additional information,
// set this to MeProblem (2).  Otherwise set to
// NoAdditionalInfo (1). Default no additional info.

// UssdString
//  See above


[Test]
title MOD_0013.001_SIM_ATK_TSY_[SEND USSD - normal]

create SimAtk simatk
create SimAtkNotify notify

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_SendUssd.xml

// SEQ 1.1
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 101
waittestclass notify
simatk CheckProactiveCommand AlphaId "7-bit USSD" UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
simatk SendTerminalResponse UssdString "USSD string received from SS" Dcs 0xF0
simatk WaitForRequest

// SEQ 1.2
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 102
waittestclass notify
simatk CheckProactiveCommand AlphaId "8-bit USSD" UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0x44
simatk SendTerminalResponse UssdString "USSD string received from SS" Dcs 0x44
simatk WaitForRequest

// SEQ 1.3
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 103
waittestclass notify
simatk CheckProactiveCommand AlphaId "UCS2 USSD" Dcs 0x48 UssdString 0417 0414 0420 0410 0412 0421 0422 0412 0423 0419 0422 0415
simatk SendTerminalResponse UssdString "USSD string received from SS" Dcs 0x48
simatk WaitForRequest

// SEQ 1.4
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 104
waittestclass notify
simatk CheckProactiveCommand AlphaId "7-bit USSD" UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
// KUssdReturnError & KSatNetworkErrorInfo, "Unknown alphabet"
simatk SendTerminalResponse GeneralResult UssdReturnError InfoType SatNetworkErrorInfo AdditionalInfo 0x47
simatk WaitForRequest

// SEQ 1.5
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 105
waittestclass notify
simatk CheckProactiveCommand AlphaId "7-bit USSD" UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
// KUssdReturnError & KSatNetworkErrorInfo, "No specific cause can be given"
simatk SendTerminalResponse GeneralResult UssdReturnError InfoType SatNetworkErrorInfo AdditionalInfo 0x00
simatk WaitForRequest

// SEQ 1.6
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 106
waittestclass notify
simatk CheckProactiveCommand AlphaId "once a RELEASE COMPLETE message containing the USSD Return Result message not containing an error has been received from the network, the ME shall inform the SIM that the command has" UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
simatk SendTerminalResponse UssdString "USSD string received from SS" Dcs 0xF0
simatk WaitForRequest

// SEQ 1.7
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 107
waittestclass notify
simatk CheckProactiveCommand UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
simatk SendTerminalResponse UssdString "USSD string received from SS" Dcs 0xF0
simatk WaitForRequest

// SEQ 1.8
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 108
waittestclass notify
simatk CheckProactiveCommand AlphaId "" UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
simatk SendTerminalResponse UssdString "USSD string received from SS" Dcs 0xF0
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify
[Endtest]

[Test]
title MOD_0013.002_SIM_ATK_TSY_[SEND USSD - icon support]

create SimAtk simatk
create SimAtkNotify notify

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_SendUssd.xml

// SEQ 2.1a
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 2011
waittestclass notify
simatk CheckProactiveCommand IconId 2 1 AlphaId "Basic Icon" UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
simatk SendTerminalResponse UssdString "USSD string received from SS" Dcs 0xF0
simatk WaitForRequest

// SEQ 2.1b
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 2012
waittestclass notify
simatk CheckProactiveCommand IconId 2 1 AlphaId "Basic Icon" UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
simatk SendTerminalResponse GeneralResult SuccessRequestedIconNotDisplayed UssdString "USSD string received from SS" Dcs 0xF0
simatk WaitForRequest

// SEQ 2.2a
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 2021
waittestclass notify
simatk CheckProactiveCommand IconId 2 2 AlphaId "Color Icon" UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
simatk SendTerminalResponse UssdString "USSD string received from SS" Dcs 0xF0
simatk WaitForRequest

// SEQ 2.2b
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 2022
waittestclass notify
simatk CheckProactiveCommand IconId 2 2 AlphaId "Color Icon" UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
simatk SendTerminalResponse GeneralResult SuccessRequestedIconNotDisplayed UssdString "USSD string received from SS" Dcs 0xF0
simatk WaitForRequest

// SEQ 2.3a
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 2031
waittestclass notify
simatk CheckProactiveCommand IconId 3 1 AlphaId "Basic Icon" UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
simatk SendTerminalResponse UssdString "USSD string received from SS" Dcs 0xF0
simatk WaitForRequest

// SEQ 2.3b
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 2032
waittestclass notify
simatk CheckProactiveCommand IconId 3 1 AlphaId "Basic Icon" UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
simatk SendTerminalResponse GeneralResult SuccessRequestedIconNotDisplayed UssdString "USSD string received from SS" Dcs 0xF0
simatk WaitForRequest

// SEQ 2.4
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 204
waittestclass notify
simatk CheckProactiveCommand IconId 3 1 UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
simatk SendTerminalResponse GeneralResult CmdDataNotUnderstood
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify
[Endtest]

[Test]
title MOD_0013.003_SIM_ATK_TSY_[SEND USSD - UCS2 support]

create SimAtk simatk
create SimAtkNotify notify

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_SendUssd.xml

// SEQ 3.1
notify UseObjectAddress simatk ESatNotifySendUssdPCmd
simatk RunIscTestCase 13 301
waittestclass notify
// Alpha Id "Hello" in Russian
simatk CheckProactiveCommand AlphaId 0417 0414 0420 0410 0412 0421 0422 0412 0423 0419 0422 0415 UssdString "ABCDEFGHIJKLMNOPQRSTUVWXYZ-abcdefghijklmnopqrstuvwxyz-1234567890" Dcs 0xF0
simatk SendTerminalResponse UssdString "USSD string received from SS" Dcs 0xF0
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify
[Endtest]
