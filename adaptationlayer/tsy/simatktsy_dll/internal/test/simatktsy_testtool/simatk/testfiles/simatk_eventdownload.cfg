//* Copyright (c) 2009 Nokia Corporation and/or its subsidiary(-ies).
//* All rights reserved.
//* This component and the accompanying materials are made available
//* under the terms of the License "Eclipse Public License v1.0"
//* which accompanies this distribution, and is available
//* at the URL "http://www.eclipse.org/legal/epl-v10.html".
//*
//* Initial Contributors:
//* Nokia Corporation - initial contribution.
//*
//* Contributors:
//*
//* Description:  


//
// Precondition: 
// - Detailed description can be found from Quality Center's Project: CoreSW_CASW/Module Tests/SIM ATK TSY/SimAtkTSY_testtool
//
// Script description:

// Proactive command //
///////////////////////

// Type (default 1, UpdateEventList)
//  Determines the command type: does the command contain a new event list or does it cancel
//  the previous event list.
//      0 SetUpEventListTypeNotSet, value used in constructor.
//      1 UpdateEventList, command contains a new event list that replaces any previous list.
//      2 RemoveExistingEventList, command contains no event list.  
//        Instead, remove any existing events from the list.

// Events
//  Flags form the list of events in a SET UP EVENT LIST proactive command. Used with Type UpdateEventList.
//  Not all Events are passed to client. These event have value 0 in the list below.
//      0x0000, MT call
//      0x0000, Call connected
//      0x0000, Call disconnected
//      0x0000, Location status
//      0x0010, User activity
//      0x0020, Idle screen available
//      0x0040, Card reader status
//      0x0080, Language selection
//      0x0100, Browser termination
//      0x0200, Data available
//      0x0400, Channel status
//      0x0000, Access Technology Change
//      0x1000, Display parameters changed
//      0x2000  Local connection
// Example:
// Events 0x30 (User activity & idle screen available)
// Events 0  (Call connected & disconnected)
        
// Terminal Response //
///////////////////////

// GeneralResult
//  General result of the proactive command. Default command performed successfully.

// AdditionalInfo
//  Contains additional information associated with certain error codes set in GeneralResult. 
//  If the value in iGeneralResult does not require any information then leave this field empty (default).

// InfoType
//  If the value of GeneralResult requires additional information, set this to MeProblem.  Otherwise set to
//  NoAdditionalInfo (default)

// Envelope //
//////////////

// For Client originated event, use the same Events list and SessionEnd 0 for not to wait SIM session end:
// Example: SendEnvelope Events 0x10 SessionEnd 0

// Some Client originated events use additional data.

// Browser Termination:

// Cause
// Describes the reason that the browser terminated.
//  0	= Unknown Cause, The browser termination cause is unknown.
//  1   = User Termination, The browser was terminated by the user.
//  2	= Error Termination, The browser was terminated by an error.

// Example: SendEnvelope Events 0x100 Cause 1 SessionEnd 0

// Language Selection:

// Language
// Consists of 2 bytes. Each language code is a pair of alpha numeric characters, defined in ISO 639. 
// Each alpha numeric character is coded on one byte using the SMS default 7-bit coded alphabet as defined in
// ISO 639 (1988): "Code for the representation of names of languages". Coding examples: 'de' -> '6465', fi -> '6669', etc.

// Example: 

// Data Available: SendEnvelope Events 0x80 Language 0x6669 SessionEnd 0

// ChannelStatus
// Two bytes describing the Status of the channel
//	-	Coding of byte 1:
//		-	bit 1 to 3:	Channel identifier : 1..7;
//			Channel identifier 0 means "No channel available".
//		-	bit 4 to 7:	RFU.
//		-	bit 8:	0 = Link not established or PDP context not activated;
//			1 = Link established or PDP context not activated.

//	-	Coding of byte 2:
//		-	'00' = No further info can be given;
//		-	'01' = Not used;
//		-	'02' = Not used;
//		-	'03' = Not used;
//		-	'04' = Not used;
//		-	'05' = Link dropped;
//		-	all other values are reserved.

// DataLength
// The Channel data length codes:
//	-	either the number of bytes that are available in a channel buffer (Tx or Rx buffers negotiated during OPEN CHANNEL) 
//		using TERMINAL RESPONSE. Since the Tx or Rx buffer size can be larger than 255 bytes, 'FF' means "more than 255 bytes are available".
//	-	or the number of bytes that are requested in a RECEIVE DATA or transmitted in a SEND DATA command.

// Example: SendEnvelope Events 0x200 ChannelStatus 81 00 DataLength 08 SessionEnd 0

// Channel Status:

// ChannelStatus, as described above
// Example: SendEnvelope Events 0x400 ChannelStatus 01 05 SessionEnd 0

// Following Client originated events not currently supported by TSY:
//      0x0040, Card reader status
//      0x1000, Display parameters changed (no defined tests in 51.010)
//      0x2000  Local connection (no defined tests in 51.010)

// Usage of other Proactive commands are explained in command specific .cfg-files


[Test]
title MOD_0032.001_SIM_ATK_TSY_[EVENT DOWNLOAD - MT Call Event (normal)]

create SimAtk simatk
create SimAtkNotify notify
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_EventDownload.xml

notify UseObjectAddress simatk ESatNotifySetUpEventListPCmd
simatk RunIscTestCase 32 101
waittestclass notify
simatk CheckProactiveCommand Events 0
simatk SendTerminalResponse

simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notify
delete simatk
[Endtest]

[Test]
title MOD_0032.002_SIM_ATK_TSY_[EVENT DOWNLOAD - Call Connected Event (MT and MO call]

create SimAtk simatk
create SimAtkNotify notify
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_EventDownload.xml

notify UseObjectAddress simatk ESatNotifySetUpEventListPCmd
simatk RunIscTestCase 32 102
waittestclass notify
simatk CheckProactiveCommand Events 0
simatk SendTerminalResponse

simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notify
delete simatk
[Endtest]

[Test]
title MOD_0032.003_SIM_ATK_TSY_[EVENT DOWNLOAD - Call Connected Event (ME supporting SET UP CALL)]

create SimAtk simatk
create SimAtkNotify notify1
create SimAtkNotify notify2
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_EventDownload.xml

notify1 UseObjectAddress simatk ESatNotifySetUpEventListPCmd
notify2 UseObjectAddress simatk ESatNotifySetUpCallPCmd

simatk RunIscTestCase 32 103
waittestclass notify1
simatk CheckProactiveCommand Events 0
simatk SendTerminalResponse

waittestclass notify2
simatk CheckProactiveCommand CommandType ESatNotifySetUpCallPCmd Address "+012340123456" 2 2 AlphaId "+012340123456"
simatk SendTerminalResponse CommandType ESatNotifySetUpCallPCmd

simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notify1
delete notify2
delete simatk
[Endtest]

[Test]
title MOD_0032.004_SIM_ATK_TSY_[EVENT DOWNLOAD - Call Disconnected Event]

create SimAtk simatk
create SimAtkNotify notify
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_EventDownload.xml

notify UseObjectAddress simatk ESatNotifySetUpEventListPCmd
simatk RunIscTestCase 32 104
waittestclass notify
simatk CheckProactiveCommand Events 0
simatk SendTerminalResponse

simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notify
delete simatk
[Endtest]

[Test]
title MOD_0032.005_SIM_ATK_TSY_[EVENT DOWNLOAD - Location Status Event (normal)]

create SimAtk simatk
create SimAtkNotify notify
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_EventDownload.xml

notify UseObjectAddress simatk ESatNotifySetUpEventListPCmd
simatk RunIscTestCase 32 105
waittestclass notify
simatk CheckProactiveCommand Events 0
simatk SendTerminalResponse
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notify
delete simatk
[Endtest]

[Test]
title MOD_0032.006_SIM_ATK_TSY_[EVENT DOWNLOAD - User Activity Event (normal)]

create SimAtk simatk
create SimAtkNotify notify
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_EventDownload.xml

notify UseObjectAddress simatk ESatNotifySetUpEventListPCmd
simatk RunIscTestCase 32 106
waittestclass notify
simatk CheckProactiveCommand Events 0x10
simatk SendTerminalResponse
simatk SendEnvelope Events 0x10 SessionEnd 0
// Send another event to check that extra envelope is not send
simatk SendEnvelope Events 0x10 SessionEnd 0
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notify
delete simatk
[Endtest]

[Test]
title MOD_0032.007_SIM_ATK_TSY_[EVENT DOWNLOAD - Idle Screen Available (normal)]

create SimAtk simatk
create SimAtkNotify notify
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_EventDownload.xml

notify UseObjectAddress simatk ESatNotifySetUpEventListPCmd
simatk RunIscTestCase 32 107
waittestclass notify
simatk CheckProactiveCommand Events 0x20
simatk SendTerminalResponse
simatk SendEnvelope Events 0x20 SessionEnd 0
// Send another event to check that extra envelope is not send
simatk SendEnvelope Events 0x20 SessionEnd 0
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notify
delete simatk
[Endtest]

[Test]
title MOD_0032.008_SIM_ATK_TSY_[EVENT DOWNLOAD - Language selection event (normal)]

create SimAtk simatk
create SimAtkNotify notify
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_EventDownload.xml

notify UseObjectAddress simatk ESatNotifySetUpEventListPCmd
simatk RunIscTestCase 32 108
waittestclass notify
simatk CheckProactiveCommand Events 0x80
simatk SendTerminalResponse
simatk SendEnvelope Events 0x80 Language 0x6465 SessionEnd 0
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notify
delete simatk
[Endtest]

[Test]
title MOD_0032.009_SIM_ATK_TSY_[EVENT DOWNLOAD - Browser termination (normal)]

create SimAtk simatk
create SimAtkNotify notify
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_EventDownload.xml

notify UseObjectAddress simatk ESatNotifySetUpEventListPCmd
simatk RunIscTestCase 32 109
waittestclass notify
simatk CheckProactiveCommand Events 0x100
simatk SendTerminalResponse
simatk SendEnvelope Events 0x100 Cause 1 SessionEnd 0
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notify
delete simatk
[Endtest]

[Test]
title MOD_0032.010_SIM_ATK_TSY_[EVENT DOWNLOAD - Data available event]

create SimAtk simatk
create SimAtkNotify notify1
create SimAtkNotify notify2
create SimAtkNotify notify3
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_EventDownload.xml

notify1 UseObjectAddress simatk ESatNotifySetUpEventListPCmd
notify2 UseObjectAddress simatk ESatNotifyOpenChannelPCmd
notify3 UseObjectAddress simatk ESatNotifySendDataPCmd
simatk RunIscTestCase 32 110
waittestclass notify1
simatk CheckProactiveCommand CommandType ESatNotifySetUpEventListPCmd Events 0x200
simatk SendTerminalResponse CommandType ESatNotifySetUpEventListPCmd

waittestclass notify2
simatk CheckProactiveCommand CommandType ESatNotifyOpenChannelPCmd AccessName "\x06TestGp\x02rs" Bearer 2 BearerParams 02 04 05 05 10 02 BufferSize 1000 DestinationAddress "01.01.01.01" SimMeInterface 2 44444 UserLogin "UserLog" UserPassword "UserPwd"
simatk SendTerminalResponse CommandType ESatNotifyOpenChannelPCmd AdditionalInfo 81 0 InfoType ChannelStatusInfo BufferSize 1000 Bearer 2 BearerParams 02 04 05 05 10 02

waittestclass notify3
simatk CheckProactiveCommand CommandType ESatNotifySendDataPCmd ChannelData 0 1 2 3 4 5 6 7
simatk SendTerminalResponse CommandType ESatNotifySendDataPCmd

simatk SendEnvelope Events 0x200 ChannelStatus 81 00 DataLength 08 SessionEnd 0
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notify
delete simatk
[Endtest]

[Test]
title MOD_0032.011_SIM_ATK_TSY_[EVENT DOWNLOAD - Channel Status event]

create SimAtk simatk
create SimAtkNotify notify1
create SimAtkNotify notify2

simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

// Load ISC XML -file
simatk LoadIscTests SimAtk_EventDownload.xml

notify1 UseObjectAddress simatk ESatNotifySetUpEventListPCmd
notify2 UseObjectAddress simatk ESatNotifyOpenChannelPCmd

simatk RunIscTestCase 32 111
waittestclass notify1
simatk CheckProactiveCommand CommandType ESatNotifySetUpEventListPCmd Events 0x400
simatk SendTerminalResponse CommandType ESatNotifySetUpEventListPCmd

waittestclass notify2
simatk CheckProactiveCommand CommandType ESatNotifyOpenChannelPCmd AccessName "\x06TestGp\x02rs" Bearer 2 BearerParams 02 04 05 05 10 02 BufferSize 1000 DestinationAddress "01.01.01.01" SimMeInterface 2 44444 UserLogin "UserLog" UserPassword "UserPwd"
simatk SendTerminalResponse CommandType ESatNotifyOpenChannelPCmd AdditionalInfo 81 0 InfoType ChannelStatusInfo BufferSize 1000 Bearer 2 BearerParams 02 04 05 05 10 02

simatk SendEnvelope Events 0x400 ChannelStatus 01 05 SessionEnd 0
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete notify
delete simatk
[Endtest]