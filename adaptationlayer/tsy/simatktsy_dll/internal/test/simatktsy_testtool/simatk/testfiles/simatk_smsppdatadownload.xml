<?xml version="1.0" encoding="utf-8"?> 

<!-- MOD_0029.001_SIM_ATK_TSY_[SMS-PP Data Download] -->


<isc-test-control id="29">


<!-- ******** -->
<!-- CHANNELS -->
<!-- ******** -->
<channels>
	<channel id="0x07"/>
</channels>


<!-- ****** -->
<!-- INPUTS -->
<!-- ****** -->
<inputs>

<!-- INITIALIZATION_MESSAGES -->
<!-- *********************** -->

    <input id="00001">
        <name>SIM_READ_TABLE_RESP servicetype:SIM_ST_SMSPP_DATA_DOWNLOAD_AVAIL status:SIM_SERV_OK</name>
        <direction>sos</direction>
        <message>15,00,10,09,00,06,00,01,AA,14,1a,01</message>
    </input>

<!-- SMS_RECEIVED_SIM_MSG_IND -->
<!-- ****************** -->
	
    <input id="10002">
        <name>SMS_RECEIVED_SIM_MSG_IND: SEQ 2, 3, 4</name>
        <direction>sos</direction>
        <message>15,00,10,02,00,42,00,01,00,44,00,02,00,82,00,10,02,0a,08,91,11,22,33,44,55,66,77,f8,00,1C,00,24,1C,00,04,04,91,21,43,7F,16,89,10,10,00,00,00,00,0D,53,68,6F,72,74,20,4D,65,73,73,61,67,65</message>
    </input>
	
    <input id="10006">
        <name>SMS_RECEIVED_SIM_MSG_IND: SEQ 6</name>
        <direction>sos</direction>
        <message>15,00,10,02,00,42,00,01,00,44,00,02,00,82,00,10,02,0a,08,91,11,22,33,44,55,66,77,f8,00,1C,00,24,1C,00,04,04,91,21,43,7F,f6,89,10,10,00,00,00,00,0D,53,68,6F,72,74,20,4D,65,73,73,61,67,65</message>
    </input>

<!-- ATK_SW_DATA_NTF -->
<!-- *************** -->

    <input id="30002">
        <name>ATK_SW_DATA_NTF 1.2.4</name>
        <direction>sos</direction>
        <message>15,00,10,5a,00,16,00,01,00,13,00,00,90,00,00,0b,50,68,69,6c,20,48,6f,6f,6b,65,72,00</message>
    </input>    

    <input id="30003">
        <name>ATK_SW_DATA_NTF, Command pending</name>
        <direction>sos</direction>
        <message>15,00,00,5A,00,00,78,34,00,13,00,00,91,0B,00,00</message>
    </input>

<!-- PROACTIVE COMMANDS -->
<!-- ****************** -->

    <input id="50003">
        <name>PROACTIVE COMMAND: MORE TIME 1.3.4</name>
        <direction>sos</direction>
        <message>15,28,00,5A,00,00,08,00,00,10,00,55,00,0D,D0,09,81,03,01,02,00,82,02,81,82,90,00</message>
    </input>  
    
<!-- SIM SESSION END -->
<!-- *************** -->
    <input id="90004">
        <name>ATK_SW_DATA_NTF, SIM Session End</name>
        <direction>sos</direction>
        <message>15,00,00,5A,00,00,78,34,00,13,00,00,90,00,00,00</message>
    </input>

</inputs>


<!-- ******* -->
<!-- OUTPUTS -->
<!-- ******* -->
<outputs>

<!-- ATK_ENVELOPE_NTF -->
<!-- **************** -->

    <output id="20002">
        <name>ENVELOPE: SMS-PP DOWNLOAD 1.2.2, 1.3.2, 1.4.2</name>
        <direction>dos</direction>
        <message>00,00,00,5A,00,36,34,00,C9,12,00,2F,D1,2D,82,02,83,81,06,09,91,11,22,33,44,55,66,77,F8,8B,1C,04,04,91,21,43,7F,16,89,10,10,00,00,00,00,0D,53,68,6F,72,74,20,4D,65,73,73,61,67,65,00</message>
           <mask>00,00,00,FF,00,FF,00,00,00,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>

    <output id="20006">
        <name>ENVELOPE: SMS-PP DOWNLOAD 1.6.2</name>
        <direction>dos</direction>
        <message>00,00,00,5A,00,36,34,00,C9,12,00,2F,D1,2D,82,02,83,81,06,09,91,11,22,33,44,55,66,77,F8,8B,1C,04,04,91,21,43,7F,F6,89,10,10,00,00,00,00,0D,53,68,6F,72,74,20,4D,65,73,73,61,67,65,00</message>
           <mask>00,00,00,FF,00,FF,00,00,00,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>

<!-- SMS_RECEIVED_MSG_REPORT_REQ -->
<!-- ****************************** -->

    <output id="40002">
        <name>SMS_RECEIVED_MSG_REPORT_REQ: SEQ 2</name>
        <direction>dos</direction>
        <message>00,00,10,02,00,26,00,01,00,3B,00,00,00,00,00,02,00,1D,00,08,7F,16,01,07,00,20,00,14,00,0B,00,0B,50,68,69,6c,20,48,6f,6f,6b,65,72,00</message>
           <mask>00,00,00,FF,00,FF,00,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>
    
    <output id="40003">
        <name>SMS_GSM_RECEIVED_PP_REPORT_REQ: SEQ 3, 4</name>
        <direction>dos</direction>
        <message>00,00,10,02,00,0a,00,01,00,3B,00,00,00,00,00,00</message>
           <mask>00,00,00,FF,00,FF,00,00,00,FF,FF,FF,FF,FF,FF,FF</mask>
    </output>
    
<!-- TERMINAL RESPONSES -->
<!-- ****************** -->

    <output id="60003">
        <name>TERMINAL RESPONSE: MORE TIME 1.3.5</name>
        <direction>dos</direction>
        <message>1D,00,10,5A,00,16,00,08,00,11,00,00,00,0C,81,03,01,02,00,82,02,82,81,83,01,00,00,00</message>
           <mask>00,00,00,FF,00,FF,00,00,00,FF,FF,FF,FF,FF,FF,FF,FF,FF,FF,7F,FF,FF,FF,7F,FF,FF,FF,FF</mask>
    </output>
        
</outputs>


<!-- ********** -->
<!-- TEST STEPS -->
<!-- ********** -->
<steps>

<!-- INITIALIZATION_MESSAGES -->
<!-- *********************** -->
    <step id="00001" type="simulate">
        <name>Send SIM_READ_TABLE_RESP</name>
        <channel id="0x07"/>
        <input-ref id="00001"/>
    </step>

<!-- SMS_RECEIVED_SIM_MSG_IND -->
<!-- ****************** -->
    <step id="10002" type="simulate">
        <name>Send IND</name>
        <channel id="0x07"/>
        <input-ref id="10002"/>
    </step>

    <step id="10006" type="simulate">
        <name>Send IND</name>
        <channel id="0x07"/>
        <input-ref id="10006"/>
    </step>

<!-- ATK_ENVELOPE_NTF -->
<!-- **************** -->
    <step id="20002" type="intercept">
        <name>Intercept Envelope</name>
        <channel id="0x07"/>
        <output-ref id="20002"/>
        <flags>0x40</flags>  <!-- Store transaction ID from intercepted message -->
    </step>
    
    <step id="20006" type="intercept">
        <name>Intercept Envelope</name>
        <channel id="0x07"/>
        <output-ref id="20006"/>
        <flags>0x40</flags>  <!-- Store transaction ID from intercepted message -->
    </step>
    

<!-- ATK_SW_DATA_NTF -->
<!-- *************** -->
    <step id="30002" type="simulate">
        <name>Send ATK_SW_DATA_NTF</name>
        <channel id="0x07"/>
        <input-ref id="30002"/>
        <flags>0x40</flags>  <!-- Use stored transaction ID -->
    </step>

    <step id="30003" type="simulate">
        <name>Send ATK_SW_DATA_NTF</name>
        <channel id="0x07"/>
        <input-ref id="30003"/>
        <flags>0x40</flags>  <!-- Use stored transaction ID -->
    </step>

<!-- SMS_RECEIVED_MSG_REPORT_REQ -->
<!-- ****************************** -->
    <step id="40002" type="intercept">
        <name>Intercept SMS_RECEIVED_MSG_REPORT_REQ</name>
        <channel id="0x07"/>
        <output-ref id="40002"/>
    </step>

    <step id="40003" type="intercept">
        <name>Intercept SMS_RECEIVED_MSG_REPORT_REQ</name>
        <channel id="0x07"/>
        <output-ref id="40003"/>
    </step>

<!-- PROACTIVE COMMANDS -->
<!-- ****************** -->
    <step id="50003" type="simulate">
        <name>Send PCmd</name>
        <channel id="0x07"/>
        <input-ref id="50003"/>
    </step>
    
<!-- TERMINAL RESPONSES -->
<!-- ****************** -->
    <step id="60003" type="intercept">
        <name>Intercept TR</name>
        <channel id="0x07"/>
        <output-ref id="60003"/>
        <flags>0x40</flags>  <!-- Store transaction ID from intercepted message -->
    </step>
    
<!-- GENERAL STEPS -->
<!-- ************* -->
    <step id="90001" type="sync">
        <name>Sync with test env</name>
    </step>

    <step id="90002" type="open-channel">
        <name>Attach to channel 7</name>
        <channel id="0x07"/>
    </step>

    <step id="90003" type="close-channel">
        <name>Detach from channel 7</name>
        <channel id="0x07"/>
    </step>

    <step id="90004" type="simulate">
        <name>SIM session end</name>
        <channel id="0x07"/>
        <input-ref id="90004"/>
        <flags>0x40</flags>  <!-- Use stored transaction ID in simulated message -->        
    </step>

</steps>


<!-- ********** -->
<!-- TEST CASES -->
<!-- ********** -->
<cases>

<!-- 27.22.5.1	SMS-PP Data Download -->

    <!-- Sequence 1.1 Void  -->
    
    <case id="102">
        <name>Sequence 1.2 (SMS-PP Data Download, General Data Coding, GET RESPONSE, Acknowledgement)</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="90002"/> <!-- Attach to channel 7 -->
            <step-ref id="00001"/> <!-- Send SIM_READ_TABLE_RESP -->
            
            <step-ref id="10002"/> <!-- Send SMS_RECEIVED_SIM_MSG_IND -->
            <step-ref id="20002"/> <!-- Receive ATK_ENVELOPE_NTF -->
            <step-ref id="30002"/> <!-- Send ATK_SW_DATA_NTF Resp -->
            <step-ref id="40002"/> <!-- Receive SMS_RECEIVED_MSG_REPORT_REQ -->
            <step-ref id="90003"/> <!-- Detach from channel 7 -->
        </test-steps>
    </case>

    <case id="103">
        <name>Sequence 1.3 (SMS-PP Data Download, General Data Coding, FETCH, MORE TIME)</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="90002"/> <!-- Attach to channel 7 -->
            <step-ref id="00001"/> <!-- Send SIM_READ_TABLE_RESP -->
            
            <step-ref id="10002"/> <!-- Send SMS_RECEIVED_SIM_MSG_IND -->
            <step-ref id="20002"/> <!-- Receive ATK_ENVELOPE_NTF -->
            <step-ref id="30003"/> <!-- Send ATK_SW_DATA_NTF Resp -->
            <step-ref id="40003"/> <!-- Receive SMS_RECEIVED_MSG_REPORT_REQ -->
            <step-ref id="50003"/> <!-- Send PCMD -->
            <step-ref id="60003"/> <!-- Receive TR -->
            <step-ref id="90004"/> <!-- Send SIM session end -->
            <step-ref id="90003"/> <!-- Detach from channel 7 -->
        </test-steps>
    </case>
    
    <case id="104">
        <name>Sequence 1.4 (SMS-PP Data Download, General Data Coding)</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="90002"/> <!-- Attach to channel 7 -->
            <step-ref id="00001"/> <!-- Send SIM_READ_TABLE_RESP -->
            
            <step-ref id="10002"/> <!-- Send SMS_RECEIVED_SIM_MSG_IND -->
            <step-ref id="20002"/> <!-- Receive ATK_ENVELOPE_NTF -->
            <step-ref id="90004"/> <!-- Send ATK_SW_DATA_NTF Resp -->
            <step-ref id="40003"/> <!-- Receive SMS_RECEIVED_MSG_REPORT_REQ -->
            <step-ref id="90003"/> <!-- Detach from channel 7 -->
        </test-steps>
    </case>
    
    <!-- Sequence 1.5 Void -->

    <case id="106">
        <name>Sequence 1.6 (SMS-PP Data Download, with Data Coding / Message Class)</name>
        <timeout>10</timeout>
        <test-steps>
            <step-ref id="90002"/> <!-- Attach to channel 7 -->
            <step-ref id="00001"/> <!-- Send SIM_READ_TABLE_RESP -->
            
            <step-ref id="10006"/> <!-- Send SMS_RECEIVED_SIM_MSG_IND -->
            <step-ref id="20006"/> <!-- Receive ATK_ENVELOPE_NTF -->
            <step-ref id="90004"/> <!-- Send ATK_SW_DATA_NTF Resp -->
            <step-ref id="40003"/> <!-- Receive SMS_RECEIVED_MSG_REPORT_REQ -->
            <step-ref id="90003"/> <!-- Detach from channel 7 -->
        </test-steps>
    </case>    

</cases>

</isc-test-control>
