//* Copyright (c) 2009 Nokia Corporation and/or its subsidiary(-ies).
//* All rights reserved.
//* This component and the accompanying materials are made available
//* under the terms of the License "Eclipse Public License v1.0"
//* which accompanies this distribution, and is available
//* at the URL "http://www.eclipse.org/legal/epl-v10.html".
//*
//* Initial Contributors:
//* Nokia Corporation - initial contribution.
//*
//* Contributors:
//*
//* Description:  

//
// Precondition: 
// - Detailed description can be found from Quality Center's Project: CoreSW_CASW/Module Tests/SIM ATK TSY/SimAtkTSY_testtool
//
// Script description:

// *********************************
// CheckProactiveCommand parameters:
// *********************************
// RefreshType (Mandatory)
// 0    //// not set 
// 1    ///< SIM or USIM Initialization and Full File Change Notification.
// 2	///< SIM or USIM File Change Notification.
// 3	///< SIM or USIM Initialization and File Change Notification.
// 4    ///< SIM or USIM Initialization.
// 5	///< GSM SIM or UICC Reset.
// 6	///< USIM Application Reset.
// 7	///< 3G Session Reset.

// FileList (optional)
// empty or missing == no files
// Eg. FileList 6F38 6F33 6F22

// AID (Optional)
// empty or missing == not set
// Eg. AID A0 00 00 00 01 A1 A2 A3

[Test]
title MOD_0008.001_SIM_ATK_TSY_[REFRESH - normal]

create SimAtk simatk
create SimAtkNotify notify1
create SimAtkNotify notify2

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

simatk LoadIscTests SimAtk_Refresh.xml

// Seq 1.1
print "Start seq 1.1"
notify1 UseObjectAddress simatk ESatNotifyRefreshRequiredParam
notify2 UseObjectAddress simatk ESatNotifyRefreshPCmd
simatk RunIscTestCase 8 101
waittestclass notify1
// check type of refresh
simatk CheckProactiveCommand RefreshType 04
// Send RefreshAllowed
simatk SendTerminalResponse CommandType ESatNotifyRefreshRequiredParam
// wait until PCMD is received
waittestclass notify2
//Send terminal response for proactive command
simatk SendTerminalResponse CommandType ESatNotifyRefreshPCmd
// wait until ISC test case is completed
simatk WaitForRequest

// Seq 1.2
print "Start seq 1.2"
notify1 UseObjectAddress simatk ESatNotifyRefreshRequiredParam
notify2 UseObjectAddress simatk ESatNotifyRefreshPCmd
simatk RunIscTestCase 8 102
waittestclass notify1
// check type of refresh
simatk CheckProactiveCommand RefreshType 02 FileList 6F3B
// Send RefreshAllowed
simatk SendTerminalResponse CommandType ESatNotifyRefreshRequiredParam
// wait until PCMD is received
waittestclass notify2
//Send terminal response for proactive command
simatk SendTerminalResponse CommandType ESatNotifyRefreshPCmd GeneralResult 03
// wait until ISC test case is completed
simatk WaitForRequest

// Seq 1.3
print "Start seq 1.3"
notify1 UseObjectAddress simatk ESatNotifyRefreshRequiredParam
notify2 UseObjectAddress simatk ESatNotifyRefreshPCmd
simatk RunIscTestCase 8 103
waittestclass notify1
// check type of refresh
simatk CheckProactiveCommand RefreshType 03 FileList 6F30
// Send RefreshAllowed
simatk SendTerminalResponse CommandType ESatNotifyRefreshRequiredParam
// wait until PCMD is received
waittestclass notify2
//Send terminal response for proactive command
simatk SendTerminalResponse CommandType ESatNotifyRefreshPCmd 
// wait until ISC test case is completed
simatk WaitForRequest

// Seq 1.4
print "Start seq 1.4"
notify1 UseObjectAddress simatk ESatNotifyRefreshRequiredParam
notify2 UseObjectAddress simatk ESatNotifyRefreshPCmd
simatk RunIscTestCase 8 104
waittestclass notify1
// check type of refresh
simatk CheckProactiveCommand RefreshType 01
// Send RefreshAllowed
simatk SendTerminalResponse CommandType ESatNotifyRefreshRequiredParam
// wait until PCMD is received
waittestclass notify2
//Send terminal response for proactive command
simatk SendTerminalResponse CommandType ESatNotifyRefreshPCmd 
// wait until ISC test case is completed
simatk WaitForRequest

// Seq 1.5
print "Start seq 1.5"
notify1 UseObjectAddress simatk ESatNotifyRefreshRequiredParam
notify2 UseObjectAddress simatk ESatNotifyRefreshPCmd
simatk RunIscTestCase 8 105
waittestclass notify1
// check type of refresh
simatk CheckProactiveCommand RefreshType 05
// Send RefreshAllowed
simatk SendTerminalResponse CommandType ESatNotifyRefreshRequiredParam
// wait until PCMD is received
waittestclass notify2
//Send terminal response for proactive command
simatk SendTerminalResponse CommandType ESatNotifyRefreshPCmd SessionEnd 0
// wait until ISC test case is completed
simatk WaitForRequest

// Seq 1.6 is not implemented. From the refresh point of view it is simlar than Seq 1.1.
print "Seq 1.6 is not implemented. From the refresh point of view it is simlar than Seq 1.1."

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete notify1
delete notify2
[Endtest]

[Test]
title MOD_0008.002_SIM_ATK_TSY_[REFRESH - IMSI changing procedure]

create SimAtk simatk
create SimAtkNotify refreshRequired
create SimAtkNotify refresh

// open all
simatk Connect RTelServer
simatk Load PhoneTsy.tsy
simatk Open DefaultPhone
simatk Open SAT
simatk Open IscControl

simatk LoadIscTests SimAtk_Refresh.xml

// Seq 2.1
refreshRequired UseObjectAddress simatk ESatNotifyRefreshRequiredParam
refresh UseObjectAddress simatk ESatNotifyRefreshPCmd
simatk RunIscTestCase 8 201
waittestclass refreshRequired
// check type of refresh
simatk CheckProactiveCommand RefreshType 03 FileList 6F07 6F7E 6F20
// Send RefreshAllowed
simatk SendTerminalResponse CommandType ESatNotifyRefreshRequiredParam
// wait until PCMD is received
waittestclass refresh
//Send terminal response for proactive command
simatk SendTerminalResponse CommandType ESatNotifyRefreshPCmd
// wait until ISC test case is completed
simatk WaitForRequest

// Seq 2.2
refreshRequired UseObjectAddress simatk ESatNotifyRefreshRequiredParam
refresh UseObjectAddress simatk ESatNotifyRefreshPCmd
simatk RunIscTestCase 8 202
waittestclass refreshRequired
// check type of refresh
simatk CheckProactiveCommand RefreshType 01
// Send RefreshAllowed
simatk SendTerminalResponse CommandType ESatNotifyRefreshRequiredParam
// wait until PCMD is received
waittestclass refresh
//Send terminal response for proactive command
simatk SendTerminalResponse CommandType ESatNotifyRefreshPCmd GeneralResult RefreshAdditionEFRead
// wait until ISC test case is completed
simatk WaitForRequest

// Seq 2.3
refreshRequired UseObjectAddress simatk ESatNotifyRefreshRequiredParam
refresh UseObjectAddress simatk ESatNotifyRefreshPCmd
simatk RunIscTestCase 8 203
waittestclass refreshRequired
// check type of refresh
simatk CheckProactiveCommand RefreshType 05
// Send RefreshAllowed
simatk SendTerminalResponse CommandType ESatNotifyRefreshRequiredParam
// wait until PCMD is received
waittestclass refresh
//Send terminal response for proactive command
simatk SendTerminalResponse CommandType ESatNotifyRefreshPCmd SessionEnd 0
// wait until ISC test case is completed
simatk WaitForRequest

// close all
simatk Close IscControl
simatk Close SAT
simatk Unload PhoneTsy.tsy
simatk Close RTelServer
delete simatk
delete refreshRequired
delete refresh
[Endtest]
