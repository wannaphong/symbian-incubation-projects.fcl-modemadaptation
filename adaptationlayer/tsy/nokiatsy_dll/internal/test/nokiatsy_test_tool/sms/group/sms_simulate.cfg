//* Copyright (c) 2009 Nokia Corporation and/or its subsidiary(-ies).
//* All rights reserved.
//* This component and the accompanying materials are made available
//* under the terms of the License "Eclipse Public License v1.0"
//* which accompanies this distribution, and is available
//* at the URL "http://www.eclipse.org/legal/epl-v10.html".
//*
//* Initial Contributors:
//* Nokia Corporation - initial contribution.
//*
//* Contributors:
//*
//* Description:
//*


// MOD_0001.001_2_NokiaTSY_[XML Send sms message, length 149]
//
// Precondition:
// - n/a
//
// Script description:
// - First parameter is destination phone number
// - Second parameter is service center phone number
// - SMS is sent and the sent data is checked.
//
[Test]
title MOD_0001.001_2_NokiaTSY_[XML Send sms message, length 149]
create NTT_SMS test

test HandleSpecifiedRequests YES

// First parameter: is parameter check required (ON/OFF)
// Second parameter: test case number ( 1 = ETestCaseSms001 )
test SetSmsParameterCheck ON 1
// Reference parameters: message reference(47), length of pdu(10), pdu data(1 01 0 0 0 0 0 0 0 0)
test SetSmsReferenceParameters 47 10 1 0 0 0 0 0 0 0 0 0

test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMobileSmsMessagingSendMessage

test RunIscTestCase 101
test SyncIscTestCase
test SendSMSMessage SendSMSMessage4 04544103076 +358454400046

// EMobileSmsMessagingSendMessage
allownextresult 0
waittestclass test

test HandleSpecifiedRequests NO
test SetSmsParameterCheck OFF 0

delete test
[Endtest]


// MOD_0001.002_2_NokiaTSY_[XML Send SAT originated SMS message, length 149]
//
// Precondition:
// - n/a
//
// Script description:
// - First parameter is destination phone number
// - Second parameter is service center phone number
// - SMS is sent and the sent data is checked.
//

[Test]
title MOD_0001.002_2_NokiaTSY_[XML Send SAT originated SMS message, length 149]
create NTT_SMS test

test HandleSpecifiedRequests YES

test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMmTsySmsSendSatMessage
test SetSmsParameterCheck OFF 0 // Only aResult is checked

test RunIscTestCase 115
test SyncIscTestCase
test SendSMSMessage SendSMSMessage4 04544103076 +358454400046 SAT_ORIGINATED

// EMmTsySmsSendSatMessage
allownextresult 0
waittestclass test

test HandleSpecifiedRequests NO

delete test
[Endtest]

// title MOD_0001.003_2_NokiaTSY_[XML SMS sending ongoing and a new SMS is sent]
//
// Precondition:
// - n/a
//
// Script description:
// - First parameter is destination phone number
// - Second parameter is service center phone number
// - The first SMS is sent
// - A new SMS is sent before current sending hasn't been completed.

[Test]
title MOD_0001.003_2_NokiaTSY_[XML SMS sending ongoing and a new SMS is sent]
create NTT_SMS test

test HandleSpecifiedRequests YES

test InitializeIPCRequestTable

test RunIscTestCase 116 // Run dummy case to start NTSY
test SyncIscTestCase

test SendSMSMessage SendSMSMessage4 04544103076 +358454400046
test SendSMSMessage SendSMSMessage4 04544103076 +358454400046

allownextresult -16 // KErrServerBusy
waittestclass test

test HandleSpecifiedRequests NO

delete test
[Endtest]

// MOD_0001.004_2_NokiaTSY_[XML Send sms message , No FDN check, length 149]
//
// Precondition:
// - n/a
//
// Script description:
// - First parameter is destination phone number
// - Second parameter is service center phone number
// - SMS is sent and the sent data is checked.
// - FDN is not checked.
//
[Test]
title MOD_0001.004_2_NokiaTSY_[XML Send sms message , No FDN check, length 149]
create NTT_SMS test

test HandleSpecifiedRequests YES

// First parameter: is parameter check required (ON/OFF)
// Second parameter: test case number ( 1 = ETestCaseSms001 )
test SetSmsParameterCheck ON 1
// Reference parameters: message reference(47), length of pdu(10), pdu data(1 01 0 0 0 0 0 0 0 0)
test SetSmsReferenceParameters 47 10 1 0 0 0 0 0 0 0 0 0

test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMobileSmsMessagingSendMessageNoFdnCheck

test RunIscTestCase 117
test SyncIscTestCase
test SendSMSMessage SendSMSMessage4 04544103076 +358454400046 NO_FDN_CHECK

// EMobileSmsMessagingSendMessage
allownextresult 0
waittestclass test

test HandleSpecifiedRequests NO
test SetSmsParameterCheck OFF 0

delete test
[Endtest]

// MOD_0001.008_2_NokiaTSY_[XML Read SMS Parameters from SIM]
//
// Precondition:
// - n/a
//
// Script description:
// - n/a
//
[Test]
title MOD_0001.008_2_NokiaTSY_[XML Read SMS Parameters from SIM]
create NTT_SMS test

test HandleSpecifiedRequests YES
test SetSmsParameterCheck ON 8
// Reference parameters to be checked in complete:
// Number of SMS parameter sets (2)
// SMS parameter set 1: parameter indicator, protocol id, data coding scheme, validity period, service center address, destination // address, alpha tag
// SMS parameter set 2: same as in set 1 (255/NA means that this parameter is not valid and not needed to check)
test SetSmsReferenceParameters 2 31 1 2 1 +358454400050 +358503655150 NTN 255 255 255 255 NA NA NA

test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMobileSmsMessagingGetSmspListPhase1

test RunIscTestCase 111
test SyncIscTestCase
test ReadSmsParameters

allownextresult 0
waittestclass test
test HandleSpecifiedRequests NO
test SetSmsParameterCheck OFF 0
delete test
[Endtest]


// MOD_0001.009_2_NokiaTSY_[XML Store SMS Parameters to SIM]
//
// Precondition:
// - Edit the following script parameters if necessary:
//    - SIM location, default is 1
//    - SMSC number, default is +358454400050 for Nokia Test Network
//    - Alpha tag (description) of the SMSP set
//
// Script description:
// - USE WITH CAUTION, this test case easily can mess up your SIM. There is
//   no way to set these values from S60 UI. The values below are OK for Nokia
//   test SIMs.
//   Parameters are: SIM location, service center number (in international
//   format), alpha tag (max. 16 characters).
//
[Test]
title MOD_0001.009_1_NokiaTSY_[HW Store SMS Parameters to SIM]
create NTT_SMS test

test HandleSpecifiedRequests YES
test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMobileSmsMessagingStoreSmspList

pause 1000
test RunIscTestCase 114
test SyncIscTestCase
test StoreSmsParameters 1 +358454400050 tekstiviesti

allownextresult 0
waittestclass test
pause 1000
delete test
[Endtest]


// MOD_0001.010_2_NokiaTSY_[XML Receive Class 1 SMS message]
//
// Precondition:
// - n/a
//
// Script description:
// - Class 1 SMS is received and type of the SMS is checked.
//
[Test]
title MOD_0001.010_2_NokiaTSY_[XML Receive Class 1 SMS message]
create NTT_SMS test

test HandleSpecifiedRequests YES

test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMmTsyActivateSmsRouting
test SetExpectedCompleteIPC EMobileSmsMessagingReceiveMessage
test SetExpectedCompleteIPC EMobileSmsMessagingAckSmsStored
test SetExpectedCompleteIPC EMmTsyDeactivateSmsRouting

test RunIscTestCase 102
test SyncIscTestCase
test ActivateSMSRouting

// EMmTsyActivateSmsRouting
allownextresult 0
waittestclass test

// wait for ISC testcase completion signal
allownextresult 1
waittestclass test

test ReceiveSMSMessage Class1
test RunIscTestCase 103
test SyncIscTestCase

// EMobileSmsMessagingReceiveMessage
allownextresult 0
waittestclass test

test AckSMS

// EMobileSmsMessagingAckSmsStored
allownextresult 0
waittestclass test

test DeactivateSMSRouting

// EMmTsyDeactivateSmsRouting
allownextresult 0
waittestclass test

test HandleSpecifiedRequests NO

delete test
[Endtest]


// MOD_0001.014_2_NokiaTSY_[XML Receive Class 2 SMS message]
//
// Preconditions:
// -n/a
//
// Script description:
// - Class 2 SMS is received and type of the SMS is checked.
//
[Test]
title MOD_0001.014_2_NokiaTSY_[XML Receive Class 2 SMS message]
create NTT_SMS test

test HandleSpecifiedRequests YES

test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMmTsyBootNotifySimStatusReadyIPC
test SetExpectedCompleteIPC EMobileSmsMessagingGetMessageStoreInfo
test SetExpectedCompleteIPC EMobilePhoneStoreGetInfo
test SetExpectedCompleteIPC EMmTsyActivateSmsRouting
test SetExpectedCompleteIPC EMobileSmsMessagingReceiveMessage
test SetExpectedCompleteIPC EMobileSmsMessagingAckSmsStored
test SetExpectedCompleteIPC EMmTsyDeactivateSmsRouting


test RunIscTestCase 105
test SyncIscTestCase
test SMSCacheInitialization

// EMmTsyBootNotifySimStatusReadyIPC
allownextresult 0
waittestclass test

// EMobileSmsMessagingGetMessageStoreInfo
allownextresult 0
waittestclass test

// EMobilePhoneStoreGetInfo
allownextresult 0
waittestclass test

// wait for ISC testcase completion signal
allownextresult 1
waittestclass test

test RunIscTestCase 102
test SyncIscTestCase

test ActivateSMSRouting

// EMmTsyActivateSmsRouting
allownextresult 0
waittestclass test

// wait for ISC testcase completion signal
allownextresult 1
waittestclass test

test ReceiveSMSMessage Class2
test RunIscTestCase 104
test SyncIscTestCase

// EMobileSmsMessagingReceiveMessage
allownextresult 0
waittestclass test

test AckSMS

// EMobileSmsMessagingAckSmsStored
allownextresult 0
waittestclass test

test DeactivateSMSRouting

// EMmTsyDeactivateSmsRouting
allownextresult 0
waittestclass test

test HandleSpecifiedRequests NO

delete test
[Endtest]


// MOD_0001.015_2_NokiaTSY_[XML SMS Cacheing interrupted / case 1]
// Precondition:
// - n/a
//
// Script description:
// - n/a
//
[Test]
title MOD_0001.015_2_NokiaTSY_[XML SMS Cacheing interrupted / case 1]
create NTT_SMS test

test HandleSpecifiedRequests YES

test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMmTsyBootNotifySimStatusReadyIPC
test SetExpectedCompleteIPC EMobileSmsMessagingGetMessageStoreInfo
test SetExpectedCompleteIPC EMobilePhoneStoreGetInfo

test RunIscTestCase 106
test SyncIscTestCase
test SMSCacheInitialization

// EMmTsyBootNotifySimStatusReadyIPC
allownextresult 0
waittestclass test

// EMobileSmsMessagingGetMessageStoreInfo
allownextresult -4
waittestclass test

//EMobilePhoneStoreGetInfo
allownextresult -4
waittestclass test

test HandleSpecifiedRequests NO

delete test
[Endtest]


// MOD_0001.016_2_NokiaTSY_[XML SMS Cacheing interrupted / case 2]
//
// This test is made for error 7SW-V: Emergency Call: Emergency call during
// remote sim call causes reset correction verification
//
// Precondition:
// - n/a
//
// Script description:
// - n/a
//
[Test]
title MOD_0001.016_2_NokiaTSY_[XML SMS Cacheing interrupted / case 2]
create NTT_SMS test

test HandleSpecifiedRequests YES

test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMmTsyBootNotifySimStatusReadyIPC
test SetExpectedCompleteIPC EMobileSmsMessagingGetMessageStoreInfo
test SetExpectedCompleteIPC EMobilePhoneStoreGetInfo

test RunIscTestCase 107
test SyncIscTestCase
test SMSCacheInitialization

// EMmTsyBootNotifySimStatusReadyIPC
allownextresult 0
waittestclass test

// EMobileSmsMessagingGetMessageStoreInfo
allownextresult -330170404
waittestclass test

//EMobilePhoneStoreGetInfo
allownextresult -4
waittestclass test

test HandleSpecifiedRequests NO

delete test
[Endtest]


// MOD_0001.017_2_NokiaTSY_[XML Cacheing interrupted / case 3]
//
// Precondition:
// - n/a
//
// Script description:
// - n/a
//
[Test]
title MOD_0001.017_2_NokiaTSY_[XML Cacheing interrupted / case 3]
create NTT_SMS test

test HandleSpecifiedRequests YES

test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMmTsyBootNotifySimStatusReadyIPC
test SetExpectedCompleteIPC EMobileSmsMessagingGetMessageStoreInfo
test SetExpectedCompleteIPC EMobilePhoneStoreGetInfo
test SetExpectedCompleteIPC EMobilePhoneStoreWrite

test RunIscTestCase 109
test SyncIscTestCase
test SMSCacheInitialization

// EMmTsyBootNotifySimStatusReadyIPC
allownextresult 0
waittestclass test

// EMobileSmsMessagingGetMessageStoreInfo
allownextresult 0
waittestclass test

// EMobilePhoneStoreGetInfo
allownextresult 0
waittestclass test

test WriteSMSMessage 04544103076 +358454400046 -1

// EMobilePhoneStoreWrite
allownextresult -330170404
waittestclass test

test HandleSpecifiedRequests NO

delete test
[Endtest]


// MOD_0001.018_2_NokiaTSY_[XML Memory Capacity Exceeded]
//
// Precondition:
// - n/a
//
// Script description:
// - EMobileSmsMessagingNackSmsStored is requested and SMS_GSM_RECEIVED_PP_REPORT_REQ
//   will be send with status SMS_GSM_ERR_MEMORY_CAPACITY_EXC
//
[Test]
title MOD_0001.018_2_NokiaTSY_[XML Memory Capacity Exceeded]
create NTT_SMS test

test HandleSpecifiedRequests YES

test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMobileSmsMessagingNackSmsStored

test RunIscTestCase 110
test SyncIscTestCase
test NackSMS -4534

// ESmsMessagingNackSmsStored
allownextresult 0
waittestclass test

test HandleSpecifiedRequests NO

delete test
[Endtest]


// MOD_0001.001_019_NokiaTSY_[XML Send SMS message, CS network barred (DSAC)]
//
// Precondition:
// - The feature under test (DCM DSAC) is flagged in NTSY, because it is supported only
//   in cellmo version ICPR71. This test case cannot be run in MCL before DSAC support is
//   added to current cellmo version and flagging is removed from NTSY codes.
//   If this test case is needed to be run anyway, flagging
//   'NCP_COMMON_CELLMO_BRANCH_SUPPORT == NCP_COMMON_CELLMO_BRANCH_0711' must be removed from
//   cmmstaticutility.cpp and DSAC definition must be added to smsisi.h:
//   #define SMS_GSM_ERR_CS_BARRED 0xE8
//
// Script description:
//
// - This test case is created for SUB 417-1807: NokiaTSY: UI needed for DCM DSAC.
//   Test case simulates the situation, where SMS sending fails
//   because of barred CS network (Domain Specific Access Control)
//
[Test]
title MOD_0001.019_2_NokiaTSY_[XML Send SMS message, CS network barred (DSAC)]
create NTT_SMS test

test HandleSpecifiedRequests YES
test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMobileSmsMessagingSendMessage

// First parameter: is parameter check required (ON/OFF)
// Second parameter: test case number ( 0 = ETestCaseNotDefined )
test SetSmsParameterCheck ON 19
// Reference parameters: message reference(0), length of pdu(10), pdu data( 1 -1 0 0 0 0 0 0 0 0)
test SetSmsReferenceParameters 0 10 1 -1 0 0 0 0 0 0 0 0

test RunIscTestCase 112
test SyncIscTestCase

// KErrGsmCSConnectionBarred/KErrGeneral
allownextresult -542048258
waittestclass test

test HandleSpecifiedRequests NO
test SetSmsParameterCheck OFF 0

delete test
[Endtest]


// MOD_0001.020_2_NokiaTSY_[XML SMS settings update]
//
// Precondition:
//  N/A
//
// Script description:
//  SMS settings are updated (SMS_SETTINGS_UPDATE_REQ/SMS_SETTINGS_UPDATE_RESP)
//
[Test]
title MOD_0001.020_2_NokiaTSY_[XML SMS settings update]
create NTT_SMS test

test HandleSpecifiedRequests YES
test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMobileSmsMessagingSetMoSmsBearer

test RunIscTestCase 113
test SyncIscTestCase
test SmsSettingsUpdate

allownextresult 0
waittestclass test

test HandleSpecifiedRequests NO

delete test
[Endtest]

// MOD_0001.021_2_NokiaTSY_[XML MT SMs NACKed automatically]
//
// Precondition:
// - n/a
//
// Script description:
// - SMS_RECEIVED_MSG_IND comes and gets NACKed by testcase
// - further SMS_RECEIVED_MSG_IND NACKed by NTSY
// - storage status updated
// - SMS_RECEIVED_MSG_IND pass through again
//
[Test]
title MOD_0001.021_2_NokiaTSY_[XML MT SMs NACKed automatically]
create NTT_SMS test

test HandleSpecifiedRequests YES
test InitializeIPCRequestTable

test SetExpectedCompleteIPC EMobileSmsMessagingReceiveMessage   // MT SM 1
test SetExpectedCompleteIPC EMobileSmsMessagingNackSmsStored    // NACK
test SetExpectedCompleteIPC EMobileSmsMessagingResumeSmsReception
test SetExpectedCompleteIPC EMobileSmsMessagingReceiveMessage   // MT SM 4
test SetExpectedCompleteIPC EMobileSmsMessagingAckSmsStored     // ACK

test RunIscTestCase 119
test SyncIscTestCase

// EMobileSmsMessagingReceiveMessage
allownextresult 0
waittestclass test

test NackSMS -4534
// EMobileSmsMessagingNackSmsStored
allownextresult 0
waittestclass test

/////////////////////////////////////////////////////////////////////////////////
// NTSY NACKs 2 more MT SMs
/////////////////////////////////////////////////////////////////////////////////

// wait for isc testcase to finish
allownextresult 1
waittestclass test

test RunIscTestCase 120
test SyncIscTestCase

test ResumeSMS
// EMobileSmsMessagingResumeSmsReception
allownextresult 0
waittestclass test

// EMobileSmsMessagingReceiveMessage
allownextresult 0
waittestclass test

test AckSMS
// ESmsMessagingAckSmsStored
allownextresult 0
waittestclass test

test HandleSpecifiedRequests NO

delete test
[Endtest]

// MOD_0001.030_2_NokiaTSY_[XML Read SMS message]
//
// Preconditions:
// -n/a
//
// Script description:
// - Class 2 SMS is read from cache and completed.
//
[Test]
title MOD_0001.030_2_NokiaTSY_[XML Read SMS message]
create NTT_SMS test

test HandleSpecifiedRequests YES

test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMmTsyBootNotifySimStatusReadyIPC
test SetExpectedCompleteIPC EMobileSmsMessagingGetMessageStoreInfo
test SetExpectedCompleteIPC EMobilePhoneStoreGetInfo
test SetExpectedCompleteIPC EMmTsyActivateSmsRouting
test SetExpectedCompleteIPC EMobilePhoneStoreRead

test RunIscTestCase 105
test SyncIscTestCase
test SMSCacheInitialization

// EMmTsyBootNotifySimStatusReadyIPC
allownextresult 0
waittestclass test

// EMobileSmsMessagingGetMessageStoreInfo
allownextresult 0
waittestclass test

// EMobilePhoneStoreGetInfo
allownextresult 0
waittestclass test

// wait for ISC testcase completion signal
allownextresult 1
waittestclass test

test RunIscTestCase 102
test SyncIscTestCase

test ActivateSMSRouting

// EMmTsyActivateSmsRouting
allownextresult 0
waittestclass test

// wait for ISC testcase completion signal
allownextresult 1
waittestclass test

// Numbers after CLASS2 are expected TPDU
test ReadSMSMessage 1 KSimSmsMtNotRead EIsdnNumberPlan EInternationalNumber +358454400000 CLASS2 4 12 145 83 88 48 86 21 5 65 18 112 32 114 81 32 116 8 5 99 182 76 38  3

// EMobilePhoneStoreRead
allownextresult 0
waittestclass test

test HandleSpecifiedRequests NO

delete test
[Endtest]

// MOD_0001.031_2_NokiaTSY_[XML Read SMS messages]
//
// Preconditions:
// -n/a
//
// Script description:
// - Class 2 SMS is read from cache and completed.
//
[Test]
title MOD_0001.031_2_NokiaTSY_[XML Read SMS messages]
create NTT_SMS test

test HandleSpecifiedRequests YES

test InitializeIPCRequestTable
test SetExpectedCompleteIPC EMmTsyBootNotifySimStatusReadyIPC
test SetExpectedCompleteIPC EMobileSmsMessagingGetMessageStoreInfo
test SetExpectedCompleteIPC EMobilePhoneStoreGetInfo
test SetExpectedCompleteIPC EMobilePhoneStoreReadAllPhase1

test RunIscTestCase 118
test SyncIscTestCase
test SMSCacheInitialization

// EMmTsyBootNotifySimStatusReadyIPC
allownextresult 0
waittestclass test

// EMobileSmsMessagingGetMessageStoreInfo
allownextresult 0
waittestclass test

// EMobilePhoneStoreGetInfo
allownextresult 0
waittestclass test

// wait for ISC testcase completion signal
allownextresult 1
waittestclass test

// Numbers after CLASS2 are expected TPDU
test ReadAllSMSMessage KSimSmsMtNotRead EIsdnNumberPlan EInternationalNumber +358454400000 CLASS2 4 12 145 83 88 48 86 21 5 65 18 112 32 114 81 32 116 8 5 99 182 76 38  3

// EMobilePhoneStoreReadAllPhase1
allownextresult 0
waittestclass test

test HandleSpecifiedRequests NO

delete test
[Endtest]
